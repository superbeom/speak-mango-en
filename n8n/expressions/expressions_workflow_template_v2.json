{
  "name": "Speak Mango (Master + Loop) v1-5",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [192, -144],
      "id": "0fc2d4ae-7761-4f0c-bb72-af20ce9a75b3",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "your-gemini-api-id",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ì£¼ì œ ëª©ë¡ ì •ì˜ (ëŒ€ë¶„ë¥˜/ì†Œë¶„ë¥˜ ì²´ê³„ ì ìš©)\n    const topics = [\n      {\n        domain: \"conversation\",\n        category: \"daily\",\n        topic: \"ë¯¸êµ­ ì›ì–´ë¯¼ì´ ë§¤ì¼ ì“°ëŠ” ìƒí™œ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"business\",\n        topic: \"ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ…ì´ë‚˜ ì´ë©”ì¼ì—ì„œ ê¼­ í•„ìš”í•œ ì •ì¤‘í•œ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"travel\",\n        topic: \"í•´ì™¸ ì—¬í–‰í•  ë•Œ ìœ ìš©í•œ í•„ìˆ˜ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"shopping\",\n        topic: \"í•´ì™¸ ì§êµ¬ ì‡¼í•‘ì´ë‚˜ ë§¤ì¥ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‡¼í•‘ ê´€ë ¨ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"emotion\",\n        topic: \"ê¸°ì¨, ìŠ¬í””, í™”ë‚¨ ë“± ê°ì •ì„ ì„¬ì„¸í•˜ê²Œ í‘œí˜„í•˜ëŠ” ì˜ì–´ ë‹¨ì–´\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"slang\",\n        topic: \"ë¯¸ë“œë‚˜ ì˜í™”ì— ìì£¼ ë‚˜ì˜¤ëŠ” ìµœì‹  íŠ¸ë Œë””í•œ ìŠ¬ë­\",\n      },\n    ];\n\n    // ëœë¤ ì„ íƒ\n    const selected = topics[Math.floor(Math.random() * topics.length)];\n\n    return {\n      json: {\n        domain: selected.domain,\n        category: selected.category,\n        topic: selected.topic, // AI í”„ë¡¬í”„íŠ¸ìš©\n      },\n    };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-160, -320],
      "id": "83cfacbb-e2be-4e88-bd63-91d5d3340d41",
      "name": "Pick Category"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "operation": "getAll",
        "tableId": "expressions",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "expression",
              "condition": "ilike",
              "keyValue": "=\"*{{ $('Parse Master JSON').item.json.expression }}*\""
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1072, -320],
      "id": "23a0f781-e07f-4abd-b5c2-b5ed79380d19",
      "name": "Check Duplicate",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "7588390d-2c9b-4409-9df3-6e365605d4a6",
              "leftValue": "={{ $('Check Duplicate').first().json.expression }}",
              "rightValue": 0,
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [1232, -320],
      "id": "544adfb5-4479-4606-9909-3f1900d2c434",
      "name": "If New"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "tableId": "expressions",
        "dataToSend": "autoMapInputData"
      },
      "id": "20edaecb-b22f-48ae-bf0c-2017af5b2160",
      "name": "Supabase Insert",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [2624, -80],
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "operation": "getAll",
        "tableId": "expressions",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "category",
              "condition": "eq",
              "keyValue": "={{ $('Pick Category').item.json.category }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [16, -320],
      "id": "763a581a-16de-4571-a6f3-fe363033b5b7",
      "name": "Get Existing Expressions",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "notesInFlow": false,
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Generate UUID\n// ì¤‘ë³µì´ ì•„ë‹˜ì´ í™•ì¸ëœ í›„, ì €ì¥ ê²½ë¡œ ë° DB IDë¡œ ì‚¬ìš©í•  UUIDë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\n\n// ì›ë³¸ ë°ì´í„° ë³µì› (Check Duplicate ë…¸ë“œì—ì„œ ë°ì´í„°ê°€ ì†Œì‹¤ë˜ë¯€ë¡œ Validate Contentì—ì„œ ê°€ì ¸ì˜´)\n\n// ì£¼ì˜: ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë…¸ë“œ ì•ì˜ ê²€ì¦ ë…¸ë“œ ì´ë¦„ì´ 'Validate Content'ì—¬ì•¼ í•©ë‹ˆë‹¤.\n\nconst originalData = $('Validate Content').item.json;\n\n\n// crypto ëª¨ë“ˆì´ ê¸€ë¡œë²Œì— ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì§ì ‘ UUID v4 ìƒì„± ë¡œì§ ì‚¬ìš©\nconst uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n  const r = Math.random() * 16 | 0;\n  const v = c === 'x' ? r : (r & 0x3 | 0x8);\n  return v.toString(16);\n});\n\nreturn {\n  json: {\n    ...originalData,\n    id: uuid\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1824, -80],
      "id": "25485151-999e-43c0-820d-532dd1dd6bea",
      "name": "Generate ID"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Prepare TTS Requests (Groq Orpheus V1)\n// ëŒ€í™”ë¬¸ì˜ ì—­í• (A, B)ì— ë”°ë¼ ì•„ì´í…œì„ ë¶„ë¦¬í•˜ê³  ê°ê° ëª©ì†Œë¦¬ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.\n\nconst items = $input.all();\nlet results = [];\n\nitems.forEach((item, itemIndex) => {\n  const data = item.json;\n\n  // top-level dialogue ì¶”ì¶œ\n  const dialogueEntries = data.dialogue || [];\n  const expressionId = data.id;\n\n  dialogueEntries.forEach((entry, lineIndex) => {\n    const rawText = entry.en || \"\";\n    const role = (entry.role || \"A\").toUpperCase();\n\n    // í…ìŠ¤íŠ¸ ì •ì œ\n    const cleanedText = rawText.replace(/\\n/g, \" \").replace(/\\s+/g, \" \").trim();\n\n    // ì—­í• ë³„ ëª©ì†Œë¦¬ í• ë‹¹\n    const voice = role === \"B\" ? \"troy\" : \"hannah\";\n\n    results.push({\n      json: {\n        ...data, // ì›ë³¸ ë°ì´í„° ìœ ì§€\n        tts_input: cleanedText.substring(0, 200),\n        tts_voice: voice,\n        tts_line_index: lineIndex,\n        tts_model: \"canopylabs/orpheus-v1-english\",\n        tts_format: \"wav\",\n        tts_endpoint: \"https://api.groq.com/openai/v1/audio/speech\",\n        // Storage ì €ì¥ì„ ìœ„í•œ ê²½ë¡œ í™•ì •\n        storage_path: `expressions/${expressionId}/${lineIndex}.wav`,\n      },\n      pairedItem: { item: itemIndex },\n    });\n  });\n});\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1984, -80],
      "id": "78cad277-336e-4079-960d-8de4f591d396",
      "name": "Prepare TTS Requests"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/audio/speech",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "canopylabs/orpheus-v1-english"
            },
            {
              "name": "input",
              "value": "={{ $json.tts_input }}"
            },
            {
              "name": "voice",
              "value": "={{ $json.tts_voice }}"
            },
            {
              "name": "response_format",
              "value": "wav"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [2144, -80],
      "id": "88915cba-49cc-4094-a756-7336e1b195cf",
      "name": "Groq Orpheus TTS",
      "credentials": {
        "httpHeaderAuth": {
          "id": "your-http-header-auth-id",
          "name": "Groq Header Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://<YOUR_PROJECT_REF>.supabase.co/storage/v1/object/speak-mango-en/{{ $json.storage_path }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [2304, -80],
      "id": "ba44eaeb-e496-4a8b-9e82-56ddf5adda98",
      "name": "Upload to Storage",
      "credentials": {
        "httpHeaderAuth": {
          "id": "your-http-header-auth-id",
          "name": "Supabase Header Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Aggregate TTS Results\n// ë¶„ë¦¬ë˜ì—ˆë˜ ëŒ€í™”ë¬¸ ë¼ì¸ë“¤ì„ ë‹¤ì‹œ í•˜ë‚˜ë¡œ í•©ì¹˜ê³  audio_urlì„ ì£¼ì…í•©ë‹ˆë‹¤.\n\nconst items = $input.all();\nif (items.length === 0) return [];\n\n// 1. ì›ë³¸ ë°ì´í„° ë³µì› (Prepare TTS Requests ë…¸ë“œì˜ ê²°ê³¼ ì°¸ì¡°)\nconst firstItem = items[0];\nconst parentItemIndex = firstItem.pairedItem.item;\nconst parentData = $items(\"Prepare TTS Requests\")[parentItemIndex].json;\n\n// ì›ë³¸ ë°ì´í„° ë³µì œ (deep copy)\nlet finalData = JSON.parse(JSON.stringify(parentData));\n\n// 2. ë¶ˆí•„ìš”í•œ ì„ì‹œ í•„ë“œ ì¼ê´„ ì œê±° (tts_ ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  í•„ë“œ)\nObject.keys(finalData).forEach((key) => {\n  if (key.startsWith(\"tts_\") || key === \"storage_path\" || key === \"_validation\") {\n    delete finalData[key];\n  }\n});\n\n// 3. ì˜¤ë””ì˜¤ URL ì£¼ì…\nitems.forEach((item) => {\n  const pIdx = item.pairedItem.item;\n  const originalReq = $items(\"Prepare TTS Requests\")[pIdx].json;\n\n  const idx = originalReq.tts_line_index;\n  // Upload to Storage ê²°ê³¼(Key)ì—ì„œ ê²½ë¡œ ì¶”ì¶œ\n  let path = item.json.Key || originalReq.storage_path;\n\n  // ë²„í‚· ëª…ì¹­(speak-mango-en/)ì´ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ì œê±°í•˜ì—¬ ê²½ë¡œ ì •ê·œí™”\n  if (path.startsWith(\"speak-mango-en/\")) {\n    path = path.replace(\"speak-mango-en/\", \"\");\n  }\n\n  // top-level dialogueì— audio_url ì£¼ì…\n  if (finalData.dialogue && finalData.dialogue[idx]) {\n    finalData.dialogue[idx].audio_url = path;\n  }\n});\n\nreturn [{ json: finalData }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2464, -80],
      "id": "76363ea0-8098-456e-981e-b117d02f04e0",
      "name": "Aggregate TTS Results"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Gemini ì¶œë ¥ì— ëŒ€í•œ ì—„ê²©í•œ ê²€ì¦ ë¡œì§ (n8n ë²„ì „)\n *\n * ì‚¬ìš©ë²•:\n * 1. ì´ ì½”ë“œë¥¼ n8n Code ë…¸ë“œì— ë³µì‚¬í•˜ì„¸ìš”.\n * 2. 'Parse JSON' ë…¸ë“œ ë’¤ì— ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.\n * 3. ê° í•­ëª©ì„ ê²€ì¦í•˜ë©° ìœ„ë°˜ ì‚¬í•­ì´ ë°œê²¬ë˜ë©´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¤‘ë‹¨(ì—ëŸ¬ ë°œìƒ)í•©ë‹ˆë‹¤.\n */\n\n// ==========================================================================\n//  í—¬í¼ í•¨ìˆ˜ ë° ìƒìˆ˜\n// ==========================================================================\n\nconst REGEX = {\n  // í•œê¸€ (í•œêµ­ì–´): ìŒì ˆ, ìëª¨, í˜¸í™˜ ìëª¨\n  hangul: /[\\uAC00-\\uD7AF\\u1100-\\u11FF\\u3130-\\u318F\\uA960-\\uA97F\\uD7B0-\\uD7FF]/,\n  // ê°€ë‚˜ (ì¼ë³¸ì–´): íˆë¼ê°€ë‚˜, ê°€íƒ€ì¹´ë‚˜\n  kana: /[\\u3040-\\u309F\\u30A0-\\u30FF]/,\n  // í•œì (ì¤‘êµ­ì–´/ì¼ë³¸ì–´): í†µí•© í•œì\n  han: /[\\u4E00-\\u9FCC\\u3400-\\u4DB5]/,\n  // í‚¤ë¦´ ë¬¸ì (ëŸ¬ì‹œì•„ì–´)\n  cyrillic: /[\\u0400-\\u04FF]/,\n  // ì•„ëì–´\n  arabic: /[\\u0600-\\u06FF\\u0750-\\u077F]/,\n  // ì˜ì–´/ë¼í‹´ ë¬¸ì (ëˆ„ì¶œ ì—¬ë¶€ ì—„ê²© ê²€ì‚¬)\n  english_letters: /[a-zA-Z]/,\n  // ë§ˆí¬ë‹¤ìš´ ê²€ì‚¬ (êµµê²Œ/ì´íƒ¤ë¦­ ë§ˆì»¤: **, *) - ìŒìœ¼ë¡œ ì‚¬ìš©ë˜ê±°ë‚˜ ì‹œì‘/ë í™•ì¸\n  markdown_emphasis: /(\\*\\*|__|\\*|_)/,\n};\n\nconst TARGET_LANGS = [\"ko\", \"ja\", \"es\", \"fr\", \"de\", \"ru\", \"zh\", \"ar\"];\n\n// íœ´ë¦¬ìŠ¤í‹±: ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ê³ ìœ ëª…ì‚¬ë‚˜ ì˜ˆì™¸ì ì¸ ì¼€ì´ìŠ¤ ëª…ì‹œì  í—ˆìš©\nconst ALLOWED_ENGLISH_TERMS = [\n  \"iPhone\",\n  \"eBay\",\n  \"iMac\",\n  \"iPad\",\n  \"iOS\",\n  \"macOS\",\n];\n\nfunction validateItem(item) {\n  let errors = [];\n\n  // 1. êµ¬ì¡° ê²€ì‚¬ (Top-level)\n  if (!item.expression) errors.push(\"Missing 'expression' field.\");\n  if (!item.meaning) errors.push(\"Missing 'meaning' field.\");\n  if (!item.content) errors.push(\"Missing 'content' field.\");\n  if (!item.tags) errors.push(\"Missing 'tags' field.\");\n  if (!item.dialogue || !Array.isArray(item.dialogue)) {\n    errors.push(\"Missing 'dialogue' top-level array.\");\n  } else if (item.dialogue.length === 0) {\n    errors.push(\"'dialogue' array is empty.\");\n  }\n\n  // ê·œì¹™: Expression ë¬¸ì¥ ë¶€í˜¸\n  if (item.expression && /[.,]$/.test(item.expression.trim())) {\n    errors.push(\"Expression must not end with a period (.) or comma (,).\");\n  }\n\n  // 2. íƒœê·¸: ì†Œë¬¸ì ì˜ì–´ë§Œ í—ˆìš©, '#' ê¸ˆì§€\n  if (item.tags && Array.isArray(item.tags)) {\n    item.tags.forEach((tag) => {\n      if (tag.includes(\"#\")) errors.push(`Tag '${tag}' contains '#'.`);\n      if (tag !== tag.toLowerCase())\n        errors.push(`Tag '${tag}' must be lowercase.`);\n      if (!REGEX.english_letters.test(tag))\n        errors.push(`Tag '${tag}' must contain English letters.`);\n      if (\n        REGEX.hangul.test(tag) ||\n        REGEX.kana.test(tag) ||\n        REGEX.cyrillic.test(tag) ||\n        REGEX.arabic.test(tag)\n      ) {\n        errors.push(`Tag '${tag}' must be English ONLY.`);\n      }\n    });\n  }\n\n  // 3. ì˜ë¯¸: ëŒ€ìƒ ì–¸ì–´ë§Œ í—ˆìš© (ì˜ì–´ ì œì™¸)\n  if (item.meaning) {\n    // ê·œì¹™: English(\"en\")ë„ ê²€ì¦ ëŒ€ìƒì— í¬í•¨ (ë§ˆì¹¨í‘œ ê·œì¹™ ì ìš©ì„ ìœ„í•´)\n    const meaningLangs = [...TARGET_LANGS, \"en\"];\n    meaningLangs.forEach((lang) => {\n      const text = item.meaning[lang];\n      if (!text) {\n        errors.push(`Missing meaning for language: ${lang}`);\n        return;\n      }\n\n      // ê·œì¹™: ëŒ€ìƒ ì–¸ì–´ í˜¼ìš© ê¸ˆì§€\n      if (lang === \"ko\" && (REGEX.kana.test(text) || REGEX.han.test(text)))\n        errors.push(`Meaning (${lang}) contains Mixed Foreign Script.`);\n      if (lang === \"ja\" && REGEX.hangul.test(text))\n        errors.push(\n          `Meaning (${lang}) contains Mixed Foreign Script (Hangul).`\n        );\n\n      // ê·œì¹™: ì–¸ì–´ í˜¼ìš© ê¸ˆì§€ (ì˜ì–´ ëˆ„ì¶œ ê²€ì‚¬)\n      if ([\"ko\", \"ja\", \"zh\", \"ru\", \"ar\"].includes(lang)) {\n        checkEnglishInclusion(text, `Meaning (${lang})`, errors);\n      }\n\n      // ê·œì¹™: ë¬¸ì¥ ë¶€í˜¸ (ë§ˆì¹¨í‘œ ê¸ˆì§€ - ë¬¸ì¥ ì¤‘ê°„ í¬í•¨)\n      // ... (ë§ì¤„ì„í‘œ)ëŠ” í—ˆìš©í•˜ë˜, ê·¸ ì™¸ì˜ .ì€ ëª¨ë‘ ì—ëŸ¬ ì²˜ë¦¬\n      if (text.replace(/\\.\\.\\./g, \"\").includes(\".\")) {\n        errors.push(`Meaning (${lang}) must not contain a period (.).`);\n      }\n      if (text.includes(\";\")) {\n        errors.push(`Meaning (${lang}) must not contain a semicolon (;).`);\n      }\n    });\n  }\n\n  // 4. ì½˜í…ì¸ : ëŒ€ìƒ ì–¸ì–´ + ì˜ì–´(ì„¤ëª…ìš©) í—ˆìš©\n  if (item.content) {\n    TARGET_LANGS.forEach((lang) => {\n      const contentObj = item.content[lang];\n      if (!contentObj) {\n        errors.push(`Missing content object for language: ${lang}`);\n        return;\n      }\n\n      // êµ¬ì¡° ê²€ì‚¬ (ì–¸ì–´ë³„ ìƒì„¸ í•„ë“œ)\n      if (!contentObj.situation)\n        errors.push(`Content (${lang}) is missing 'situation'.`);\n      if (!contentObj.tip) errors.push(`Content (${lang}) is missing 'tip'.`);\n      if (!contentObj.quiz) {\n        errors.push(`Content (${lang}) is missing 'quiz'.`);\n      } else {\n        if (!contentObj.quiz.question)\n          errors.push(`Content (${lang}).quiz is missing 'question'.`);\n        if (!contentObj.quiz.answer)\n          errors.push(`Content (${lang}).quiz is missing 'answer'.`);\n\n        // ê·œì¹™: quizì— options í•„ë“œê°€ ìˆìœ¼ë©´ ì•ˆ ë¨ (DB êµ¬ì¡° ìœ„ë°˜)\n        if (contentObj.quiz.options) {\n          errors.push(\n            `Content (${lang}).quiz must NOT have 'options' field. Options should be in 'question' field as \"A. ...\", \"B. ...\", \"C. ...\".`\n          );\n        }\n\n        // ê·œì¹™: quiz.questionì— ì„ íƒì§€ A, B, Cê°€ ëª¨ë‘ í¬í•¨ë˜ì–´ì•¼ í•¨\n        if (contentObj.quiz.question) {\n          const questionText = contentObj.quiz.question;\n          const hasOptionA =\n            /\\nA\\.\\s/.test(questionText) || /^A\\.\\s/.test(questionText);\n          const hasOptionB = /\\nB\\.\\s/.test(questionText);\n          const hasOptionC = /\\nC\\.\\s/.test(questionText);\n\n          if (!hasOptionA || !hasOptionB || !hasOptionC) {\n            const missing = [];\n            if (!hasOptionA) missing.push(\"A\");\n            if (!hasOptionB) missing.push(\"B\");\n            if (!hasOptionC) missing.push(\"C\");\n            errors.push(\n              `Content (${lang}).quiz.question must contain all options (A, B, C). Missing: ${missing.join(\n                \", \"\n              )}. Format: \"Question text\\\\n\\\\nA. option1\\\\nB. option2\\\\nC. option3\"`\n            );\n          }\n        }\n      }\n\n      const fieldsToCheck = [\n        contentObj.situation,\n        contentObj.tip,\n        contentObj.quiz?.question,\n      ].filter(Boolean);\n\n      fieldsToCheck.forEach((text) => {\n        if (lang === \"ko\" && REGEX.kana.test(text))\n          errors.push(`Content (${lang}) contains Kana.`);\n        else if (lang === \"ja\" && REGEX.hangul.test(text))\n          errors.push(`Content (${lang}) contains Hangul.`);\n        else if ([\"es\", \"fr\", \"de\"].includes(lang)) {\n          if (\n            REGEX.hangul.test(text) ||\n            REGEX.kana.test(text) ||\n            REGEX.cyrillic.test(text) ||\n            REGEX.arabic.test(text)\n          ) {\n            errors.push(`Content (${lang}) contains Mixed Foreign Script.`);\n          }\n        }\n      });\n\n      if (contentObj.quiz && contentObj.quiz.answer) {\n        if (![\"A\", \"B\", \"C\"].includes(contentObj.quiz.answer)) {\n          errors.push(\n            `Quiz Answer (${lang}) must be 'A', 'B', or 'C'. Found: ${contentObj.quiz.answer}`\n          );\n        }\n      }\n\n      // ê·œì¹™: í€´ì¦ˆ ì„ íƒì§€ ì–¸ì–´ ì¼ê´€ì„±\n      if ([\"ko\", \"ja\", \"zh\", \"ru\", \"ar\"].includes(lang)) {\n        if (contentObj.quiz && contentObj.quiz.question) {\n          const lines = contentObj.quiz.question.split(\"\\n\");\n          const opts = [];\n\n          lines.forEach((line) => {\n            const trimmed = line.trim();\n            if (\n              trimmed.startsWith(\"A.\") ||\n              trimmed.startsWith(\"B.\") ||\n              trimmed.startsWith(\"C.\")\n            ) {\n              // \"A. ë‚´ìš©\" -> \"ë‚´ìš©\" ì¶”ì¶œ\n              opts.push(trimmed.substring(2).trim());\n            }\n          });\n\n          if (opts.length === 3) {\n            const isTarget = (s) => {\n              if (lang === \"ko\") return REGEX.hangul.test(s);\n              if (lang === \"ja\") return REGEX.kana.test(s) || REGEX.han.test(s);\n              if (lang === \"zh\") return REGEX.han.test(s);\n              if (lang === \"ru\") return REGEX.cyrillic.test(s);\n              if (lang === \"ar\") return REGEX.arabic.test(s);\n              return false;\n            };\n            const cnt = opts.filter(isTarget).length;\n            // 3ê°œ ëª¨ë‘ íƒ€ê²Ÿ ì–¸ì–´ì´ê±°ë‚˜(3), ëª¨ë‘ ì˜ì–´(0)ì—¬ì•¼ í•¨.\n            if (cnt !== 0 && cnt !== 3) {\n              errors.push(\n                `Quiz Options (${lang}) must be consistent (All English OR All Target). Mixed scripts found.`\n              );\n            }\n          }\n        }\n      }\n    });\n  }\n\n  // 5. ëŒ€í™”: ìµœìƒìœ„ ë ˆë²¨ ë°°ì—´\n  if (item.dialogue && Array.isArray(item.dialogue)) {\n    // ê·œì¹™: ëŒ€í™”ëŠ” 2~4í„´ ì‚¬ì´ì—¬ì•¼ í•¨ (í”„ë¡¬í”„íŠ¸ëŠ” 2~3í„´ ê¶Œì¥í•˜ë‚˜, 4í„´ë„ í—ˆìš©)\n    if (item.dialogue.length < 2 || item.dialogue.length > 4) {\n      errors.push(\n        `Dialogue length must be between 2 and 4. Found: ${item.dialogue.length}`\n      );\n    }\n\n    item.dialogue.forEach((dItem, idx) => {\n      if (dItem.en) {\n        if (REGEX.hangul.test(dItem.en) || REGEX.kana.test(dItem.en)) {\n          errors.push(`Dialogue[${idx}].en contains non-English characters.`);\n        }\n      }\n\n      if (dItem.translations) {\n        TARGET_LANGS.forEach((lang) => {\n          const text = dItem.translations[lang];\n          if (!text) return;\n\n          // ê·œì¹™: ìˆœìˆ˜ í…ìŠ¤íŠ¸ë§Œ í—ˆìš© (ë§ˆí¬ë‹¤ìš´ ê¸ˆì§€)\n          if (text.includes(\"**\") || text.includes(\"__\")) {\n            errors.push(\n              `Dialogue[${idx}].translations.${lang} contains Markdown Bold (**): \"${text}\"`\n            );\n          }\n\n          // ê·œì¹™: ì–¸ì–´ í˜¼ìš© ê¸ˆì§€ (ì˜ì–´ ëˆ„ì¶œ ê²€ì‚¬)\n          if ([\"ko\", \"ja\", \"zh\", \"ru\", \"ar\"].includes(lang)) {\n            checkEnglishInclusion(\n              text,\n              `Dialogue[${idx}].translations.${lang}`,\n              errors\n            );\n          } else {\n            // ë¼í‹´ ê³„ì—´ (es, fr, de): ì „ì²´ í‘œí˜„ì´ ëˆ„ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸\n            if (\n              item.expression &&\n              text.toLowerCase().includes(item.expression.toLowerCase())\n            ) {\n              // ê±°ì§“ ì–‘ì„± í•„í„°ë§ (ì˜ˆ: \"Pizza\" -> \"Pizza\")\n              // íœ´ë¦¬ìŠ¤í‹±: í‘œí˜„ì´ 4ê¸€ìë³´ë‹¤ ê¸´ ê²½ìš°ì—ë§Œ í”Œë˜ê·¸ ì²˜ë¦¬. ì§§ì€ ë‹¨ì–´ëŠ” ìš°ì—°ì¼ ìˆ˜ ìˆìŒ.\n              if (item.expression.length > 4) {\n                errors.push(\n                  `Dialogue[${idx}].translations.${lang} contains English expression leakage: \"${item.expression}\"`\n                );\n              }\n            }\n          }\n\n          // ê·œì¹™: ëŒ€ìƒ ì–¸ì–´ í˜¼ìš© ê¸ˆì§€\n          if (lang === \"ko\" && (REGEX.kana.test(text) || REGEX.han.test(text)))\n            errors.push(\n              `Dialogue[${idx}].translations.${lang} contains foreign script.`\n            );\n          if (lang === \"ja\" && REGEX.hangul.test(text))\n            errors.push(\n              `Dialogue[${idx}].translations.${lang} contains Hangul.`\n            );\n        });\n      }\n\n      // ê·œì¹™: ì„±ë³„-ì´ë¦„ ì¼ê´€ì„± ê²€ì¦ (Role AëŠ” ì—¬ì„±, Role BëŠ” ë‚¨ì„±)\n      if (dItem.role && dItem.en) {\n        const femaleNames = [\"sarah\", \"emily\"];\n        const maleNames = [\"mike\", \"david\"];\n\n        // í˜¸ê²© íŒ¨í„´ ê²€ì‚¬ (ìƒëŒ€ë°©ì„ ë¶€ë¥´ëŠ” ê²½ìš°ë§Œ ê²€ì¦)\n        const addressingPatterns = [\n          /^(hey|hi|hello|yo|well|so|oh|ah|guess)\\s+(\\w+)/i, // \"Hey Mike\", \"Hi Emily\", \"Guess what, Emily\"\n          /,\\s*(\\w+)[,\\.\\?!]/i, // \"..., Mike.\", \"..., Emily?\"\n          /(\\w+),\\s+(how|what|do|can|would|are|is)/i, // \"Mike, how are you?\"\n          /\\b(\\w+),\\s+(you|your|do|did|can|could|would|will)/i, // \"Emily, you...\", \"Mike, your...\"\n        ];\n\n        addressingPatterns.forEach((pattern) => {\n          const match = dItem.en.match(pattern);\n          if (match) {\n            const addressedName = match[match.length - 1].toLowerCase();\n\n            // Role A(ì—¬ì„±)ê°€ ì—¬ì„± ì´ë¦„ìœ¼ë¡œ ìƒëŒ€ë¥¼ ë¶€ë¥´ëŠ” ê²½ìš°\n            if (dItem.role === \"A\" && femaleNames.includes(addressedName)) {\n              errors.push(\n                `Dialogue[${idx}]: Role A (Female) is addressing someone as '${addressedName}' (female name). Should use male names (Mike/David).`\n              );\n            }\n\n            // Role B(ë‚¨ì„±)ê°€ ë‚¨ì„± ì´ë¦„ìœ¼ë¡œ ìƒëŒ€ë¥¼ ë¶€ë¥´ëŠ” ê²½ìš°\n            if (dItem.role === \"B\" && maleNames.includes(addressedName)) {\n              errors.push(\n                `Dialogue[${idx}]: Role B (Male) is addressing someone as '${addressedName}' (male name). Should use female names (Sarah/Emily).`\n              );\n            }\n          }\n        });\n      }\n    });\n  }\n\n  return {\n    valid: errors.length === 0,\n    errors: errors,\n  };\n}\n\n/**\n * ìŠ¤ë§ˆíŠ¸ ì˜ì–´ í¬í•¨ ê²€ì‚¬\n * í—ˆìš©:\n * 1. í—ˆìš© ëª©ë¡ì˜ ìš©ì–´ (iPhone, eBay...)\n * 2. ê³ ìœ ëª…ì‚¬ (ëŒ€ë¬¸ìë¡œ ì‹œì‘: Instagram, TikTok)\n * 3. ì•½ì–´ (ëª¨ë‘ ëŒ€ë¬¸ì: ROI, CEO)\n * ì°¨ë‹¨:\n * - ì†Œë¬¸ì ì˜ì–´ ë‹¨ì–´ (ëˆ„ì¶œ ê°€ëŠ¥ì„± ë†’ìŒ)\n */\nfunction checkEnglishInclusion(text, context, errors) {\n  const englishMatches = text.match(/[a-zA-Z]{2,}/g) || [];\n\n  const invalidWords = englishMatches.filter((word) => {\n    // 1. í—ˆìš© ëª©ë¡ì— ìˆìœ¼ë©´ í†µê³¼ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)\n    if (\n      ALLOWED_ENGLISH_TERMS.some(\n        (term) => term.toLowerCase() === word.toLowerCase()\n      )\n    )\n      return false;\n\n    // 2. ëŒ€ë¬¸ìë¡œ ì‹œì‘í•˜ë©´ í†µê³¼ (ê³ ìœ ëª…ì‚¬ / ì•½ì–´)\n    // ì˜ˆ: Instagram, TikTok, ROI, CEO, TV\n    if (/^[A-Z]/.test(word)) return false;\n\n    // 3. ê·¸ ì™¸ (ì†Œë¬¸ì)ëŠ” ì°¨ë‹¨!\n    // ì˜ˆ: \"reach\", \"out\", \"hello\", \"meaning\"\n    return true;\n  });\n\n  if (invalidWords.length > 0) {\n    errors.push(\n      `${context} contains English leakage: ${invalidWords.join(\", \")}`\n    );\n  }\n}\n\n// ==========================================================================\n//  N8N ì‹¤í–‰ ë¸”ë¡\n// ==========================================================================\n\nconst allViolations = [];\n\n// ëª¨ë“  ì…ë ¥ í•­ëª© ë°˜ë³µ\nfor (const item of $input.all()) {\n  const dataToCheck = item.json;\n\n  // ê²€ì¦ ì‹¤í–‰\n  const result = validateItem(dataToCheck);\n\n  if (!result.valid) {\n    allViolations.push({\n      expression: dataToCheck.expression,\n      errors: result.errors,\n    });\n\n    // í•­ëª©ì„ ìœ íš¨í•˜ì§€ ì•ŠìŒìœ¼ë¡œ í‘œì‹œ (ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì°¸ì¡°ìš©)\n    item.json._validation = { status: \"error\", errors: result.errors };\n\n    // 'If Error' ë…¸ë“œê°€ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ ì—ëŸ¬ í”Œë˜ê·¸ ì„¤ì •\n    item.json.error = \"Strict Validation Failed\";\n    item.json.errorDetails = result.errors;\n  } else {\n    item.json._validation = { status: \"success\" };\n  }\n}\n\n// ìœ„ë°˜ ì‚¬í•­ì€ ë¡œê·¸ë¡œ ë‚¨ê¸°ë˜, ì›Œí¬í”Œë¡œìš°ë¥¼ ì¤‘ë‹¨í•˜ì§€ ì•Šê³  'If Error' ë…¸ë“œë¡œ ë„˜ê¹€\nif (allViolations.length > 0) {\n  // ì—ëŸ¬ ë©”ì‹œì§€ í¬ë§·íŒ…\n  const errorMsg = allViolations\n    .map((v) => `[${v.expression}] Errors: ${v.errors.join(\"; \")}`)\n    .join(\"\\n\");\n\n  console.log(\n    `âŒ Strict Validation Failed for ${allViolations.length} items:\\n${errorMsg}. Passing to 'If Error' node.`\n  );\n}\n\n// ê²€ì¦ ê²°ê³¼ê°€ í¬í•¨ëœ í•­ëª© ë°˜í™˜\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [672, -64],
      "id": "0c292ac5-f633-4807-97ea-66a2cfaff98a",
      "name": "Validate Content",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [2144, 304],
      "id": "f60d3e12-3dc6-47e3-b9e5-cb7a5b78d477",
      "name": "Loop"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [-352, -320],
      "id": "8f5796a3-50d4-4b55-a6d2-7e220ded2f66",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [1744, 304],
      "id": "fb4ca88d-d029-4713-a2fd-fb1c2740dcb1",
      "name": "Wait",
      "webhookId": "cdcc7d6a-63de-4fc4-a551-f464387e35c3"
    },
    {
      "parameters": {
        "jsCode": "// 10ê°œì˜ ì•„ì´í…œ ìƒì„±\nreturn Array.from({ length: 10 }, (_, i) => ({\n  json: {\n    iteration: i + 1,\n    timestamp: new Date().toISOString(),\n    id: `item_${i + 1}`\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1968, 304],
      "id": "97105cde-58c7-4c4d-bc1a-b2d0cc515bd0",
      "name": "Generate 10 Loops"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: Professional English Content Creator & Polyglot Teacher.\nTask:\n1. Suggest ONE useful English expression related to the category below.\n2. Create a detailed study card for the following English expression in these languages: **English (en), Korean (ko), Japanese (ja), Spanish (es), French (fr), German (de), Russian (ru), Chinese (zh), and Arabic (ar)**.\n\nDomain: {{ $('Pick Category').first().json.domain }}\nCategory: {{ $('Pick Category').first().json.category }}\n\n# EXCLUDED EXPRESSIONS (Do NOT generate these):\n{{ $items(\"Get Existing Expressions\").map(item => item.json.expression).join(\", \") }}\n\nRequirements for Expression Selection:\n1. The expression must be practical and widely used by native speakers (20-30s target audience).\n2. **Do NOT use any expression listed in the 'EXCLUDED EXPRESSIONS' list.**\n3. Capitalization for 'expression':\n   - **Start with an UPPERCASE letter** if the expression is a standalone sentence or interjection (e.g., \"No worries\", \"Never mind\", \"Don't take it personally\").\n   - **Start with a lowercase letter** ONLY if it is a phrase or idiom used within a sentence (e.g., \"spill the tea\", \"hit the road\").\n4. Punctuation for 'expression': Do NOT include trailing periods (.) or commas (,). Exclamation marks (!) and question marks (?) are allowed.\n\nRequirements for Study Card Content:\n1. Tone: Friendly, humorous, and engaging (target audience: 20-30s), BUT **MUST use polite language consistently** for explanations.\n    - **English**: Use **Standard English** (Friendly, conversational, yet educational).\n    - **Korean**: Use **ì¡´ëŒ“ë§ (Jondaetmal)**.\n    - **Japanese**: Use **Desu-Masu Form (ä¸å¯§èª)**.\n    - **Spanish**: Use **'TÃº' form** but keep it respectful and professional.\n    - **French**: Use **'Tu' form** for engagement but maintain a polite, helpful tone (or 'Vous' if context demands strict formality, but 'Tu' is preferred for 20-30s friendly content).\n    - **German**: Use **'Du' form** (friendly, for 20-30s audience).\n    - **Russian**: Use **'Ğ’Ñ‹' (Polite)** for general explanations to maintain authority, or **'Ñ‚Ñ‹'** if very casual. (Stick to **Friendly 'Ğ’Ñ‹'** or respectful **'Ñ‚Ñ‹'**). Let's use **Friendly 'Ğ¢Ñ‹'** for this target audience (20-30s blog style).\n    - **Chinese**: Use **Polite yet friendly (ä½  + æ•¬è¯­/Polite particles)**.\n    - **Arabic**: Use **Modern Standard Arabic (MSA)** but with a friendly, accessible tone (avoid overly archaic vocabulary).\n\n2. For the 'meaning' field in ALL languages:\n   - **Target Language ONLY**: Meanings must be in the specified Target Language. Do NOT mix with other languages (except for 'en', which uses English).\n   - **Core Objective**: Provide **natural synonyms or equivalent phrases** that accurately convey the core meaning in a concise way. Avoid long, robotic dictionary-style definitions.\n   - **Tone**: Use a **casual, spoken tone** by default.\n     - **Korean**: Use **ë°˜ë§ (Banmal)**.\n     - **Japanese**: Use **Plain Form (Tameguchi/ã‚¿ãƒ¡å£)**.\n     - **Spanish**: Use **Informal 'TÃº' form**.\n     - **French**: Use **Informal 'Tu' form**.\n     - **German**: Use **Informal 'Du' form**.\n     - **Russian**: Use **Informal 'Ñ‚Ñ‹' form**.\n     - **Chinese**: Use **Casual speech**.\n     - **Arabic**: Use **MSA** (simplified).\n   - **Tone Exception**: If the English expression is formal or typically used in a polite situation (e.g., \"Could I...\", \"May I...\"), use a **polite tone** in all languages.\n     - **Korean**: ì¡´ëŒ“ë§ (Jondaetmal).\n     - **Japanese**: Desu-Masu Form (ä¸å¯§èª).\n     - **Spanish**: Formal 'Usted' form.\n     - **French**: Formal 'Vous' form.\n     - **German**: Formal 'Sie' form.\n     - **Russian**: Formal 'Ğ’Ñ‹' form.\n     - **Chinese**: Polite speech (using 'æ‚¨' instead of 'ä½ ').\n     - **Arabic**: Formal MSA (Fusha).\n   - For English (en) meaning: Provide a simple, clear definition or synonym in English.\n   - **Punctuation**: If the English expression is a question (?), the meaning MUST also end with a question mark (?) or be phrased as a question. Do NOT use trailing periods (.) for statements.\n   - If there are multiple meanings, separate them with ' Â· ' (middle dot).\n\n3. Formatting for 'expression':\n   - **Capitalization**: **Start with an UPPERCASE letter** if the expression is a standalone sentence or interjection (e.g., \"No worries\", \"Never mind\", \"Don't take it personally\"). **Start with a lowercase letter** ONLY if it is a phrase or idiom used within a sentence (e.g., \"spill the tea\", \"hit the road\").\n   - Punctuation: Do NOT include trailing periods (.) or commas (,). Exclamation marks (!) and question marks (?) are allowed.\n\n4. Constraint for content:\n   - **Language Usage**: Use the specific **Target Language** for all explanations (this applies to situation, tips, AND quiz questions/options).\n     *   **English Inclusion Allowed**: You MAY include the English expression or specific English keywords naturally for educational purposes.\n     *   **No Mixed Target Language Scripts**: Do NOT mix in other target languages (e.g., no Japanese characters in Korean content, no Hangul in Spanish).\n   - **NEVER use casual speech** in the explanation, tips, dialogue, or situation description (except for the 'meaning' field).\n     - **English**: Avoid text-speak (e.g., \"u\", \"r\") or excessive slang in explanations; keep it clear and accessible.\n     - **Korean**: No ë°˜ë§ (Banmal).\n     - **Japanese**: No Plain Form (Tameguchi).\n     - **Spanish/French/German/Russian**: Maintain a helpful, teacher-like tone (avoid overly colloquial slang in the explanation text itself).\n   - Do NOT mix polite and casual styles. Keep the tone consistent throughout.\n   - Do NOT address the reader as specific groups like \"Kids\" or \"Students\". Use a general, relatable tone suitable for young adults.\n\n5. Output MUST be a valid JSON object matching the schema below.\n\n6. 'meaning' and 'content' fields must contain keys for **en, ko, ja, es, fr, de, ru, zh, ar**.\n\n7. **Dialogue & Roles (CRITICAL)**:\n   - The `dialogue` field is a **TOP-LEVEL array** (sibling to `meaning` and `content`), NOT inside `content`.\n   - Create a **coherent, natural conversation** between two people (A and B).\n   - **The dialogue MUST consist of 2 or 3 turns (A -> B or A -> B -> A).**\n   - Ensure natural interaction where either speaker can use the target expression in a meaningful context (not limited to a Q&A pattern).\n   - Each entry in the `dialogue` array MUST include:\n     - `\"role\"`: Value \"A\" or \"B\" to distinguish speakers.\n       *   **Role A**: Female (Default name: Sarah/Emily).\n       *   **Role B**: Male (Default name: Mike/David).\n        *   **Name Rule**: **If using names**, use **typical American names** by default (e.g., Sarah, Mike). **DO NOT use Korean names** (e.g., Sujin, Minji) or other target language names unless specifically required by the context.\n        *   **Name Usage & Gender Consistency (CRITICAL)**:\n            -   Role A is **FEMALE** (Sarah/Emily). Role B is **MALE** (Mike/David).\n            -   When **addressing the OTHER person**:\n                *   Role A should call Role B by **MALE names** (Mike/David)\n                *   Role B should call Role A by **FEMALE names** (Sarah/Emily)\n            -   Self-introduction is allowed (e.g., \"Hi, I'm Emily\")\n            -   Referring to the other person is allowed (e.g., \"You're Mike, right?\")\n            -   **WRONG**: Role A saying \"Hey Emily, ...\" (calling another female)\n            -   **CORRECT**: Role A saying \"Hey Mike, ...\" (calling a male)\n     - `\"en\"`: The English sentence (**English ONLY**).\n     - `\"translations\"`: **CRITICAL** An object containing translations for **ALL 8 target languages**: `\"ko\"`, `\"ja\"`, `\"es\"`, `\"fr\"`, `\"de\"`, `\"ru\"`, `\"zh\"`, `\"ar\"`.\n       *   **Do NOT omit this object or any languages.**\n       *   **Target Language ONLY**: The value MUST contain ONLY the translated text in the target language.\n       *   **Pure Text Only**: Do NOT use markdown formatting (e.g., **bold**, *italic*). **Natural punctuation** (e.g., . , ? ! ') IS allowed and expected to reflect the spoken tone.\n       *   **No Mixed Language (CRITICAL)**: **NEVER** include the original English text or the English expression in the translation. (e.g., **Bad**: \"ì•ˆë…•í•˜ì„¸ìš”. Hello.\", **Good**: \"ì•ˆë…•í•˜ì„¸ìš”\")\n\n8. **Consistency**: Use the 'Example (Korean)' below as a reference for the depth, humor, and style. Apply the same quality to English, Japanese, Spanish, French, German, Russian, Chinese, and Arabic.\n\n9. **Fixed Fields**: Include the 'domain' and 'category' exactly as provided in the input.\n\n10. **Quiz Logic (CRITICAL)**:\n    - The quiz must test the understanding of the English expression.\n    - **Randomly select one of the following patterns**:\n      - **Pattern 1 (Situation -> English)**: Describe a situation in [Target Language] and ask \"Which English expression fits this situation?\". -> The options (A, B, C) MUST be **English expressions**.\n        *   *Example (Target Language: ko)*: Q: \"ì¹œêµ¬ê°€ \\\"ì´ë²ˆ ì£¼ë§ì— ì˜í™” ë³¼ê¹Œìš”?\\\"ë¼ê³  ì œì•ˆí–ˆì„ ë•Œ, ê¸ì •ì ìœ¼ë¡œ ë™ì˜í•˜ëŠ” ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ì˜ì–´ í‘œí˜„ì€?\\n\\nA. Sounds bad\\nB. Sounds good\\nC. Sounds angry\"\n      - **Pattern 2 (Expression -> Situation)**: Show the expression and ask \"When would you use this?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"ë‹¤ìŒ ì¤‘ 'What's up?'ì„ ê°€ì¥ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒí™©ì€?\\n\\nA. ğŸ’° ì€í–‰ì—ì„œ ëŒ€ì¶œ ìƒë‹´ì„ ë°›ê³  ìˆë‹¤.\\nB. ğŸš€ íšŒì‚¬ ì¤‘ì—­ íšŒì˜ì—ì„œ ë°œí‘œë¥¼ ì‹œì‘í•œë‹¤.\\nC. ğŸš¶â€â™€ï¸ ê¸¸ì„ ê±·ë‹¤ê°€ ì¹œêµ¬ì™€ ëˆˆì´ ë§ˆì£¼ì³¤ë‹¤.\"\n      - **Pattern 3 (Negative Logic)**: Ask \"Which situation is **NOT** appropriate for this expression?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"ë‹¤ìŒ ì¤‘ 'Let's touch base.'ì˜ ì‚¬ìš©ì´ ì ì ˆí•˜ì§€ ì•Šì€ ìƒí™©ì€?\\n\\nA. ğŸ™‹â€â™€ï¸ íŒ€ì›ê³¼ ì£¼ê°„ ë³´ê³ ì„œì— ëŒ€í•´ ì§§ê²Œ ì´ì•¼ê¸°í•  ë•Œ.\\nB. ğŸ¥³ ì¹œêµ¬ë“¤ê³¼ ì£¼ë§ì— ë†€ëŸ¬ ê°ˆ ê³„íšì„ ì„¸ìš¸ ë•Œ.\\nC. ğŸ§‘â€ğŸ’» ê³ ê°ê³¼ ë‹¤ìŒ ë‹¨ê³„ ë…¼ì˜ë¥¼ ìœ„í•´ ì—°ë½í•  ë•Œ.\"\n    - **Strict Formatting & Validation Rules**:\n      1. **These rules apply to ALL languages (en, ko, ja, es, fr, de, ru, zh, ar).**\n      2. **Database Structure (CRITICAL)**: The quiz object MUST contain ONLY two fields: `\"question\"` and `\"answer\"`. **DO NOT** create an `\"options\"` field.\n      3. **Options in Question Field**: You **MUST** include all 3 options (A, B, C) **inside the `\"question\"` field** as part of the question text.\n      4. **Format**: Use `\\n` (newline) to separate the question text and each option. Example format:\n         ```\n         \"question\": \"Question text here?\\n\\nA. First option\\nB. Second option\\nC. Third option\"\n         ```\n      5. The 'answer' field MUST be **only the uppercase letter** (e.g., \"A\", \"B\", \"C\"). **NEVER** include the full text of the answer.\n      6. **Randomize the correct answer position**: The correct answer MUST be randomly assigned to A, B, or C. Do NOT default to 'B'. ensure equal distribution of A, B, and C across different generations.\n\n11. **Tags (MANDATORY)**: Include a `\"tags\"` field containing an array of 3 to 5 lowercase **English** strings (**English ONLY**). These tags should be relevant keywords that help categorize the expression (e.g., \"idiom\", \"office\", \"slang\", \"travel\"). Do NOT include the '#' symbol.\n\n12. **Currency & Numbers**:\n    - Always use **`$` (USD)** for currency to maintain consistency (e.g., \"$10\", \"$50.50\"). Do not use other currencies like 'won', 'yen', or 'euro' unless the expression specifically requires it.\n    - Use commas for numbers larger than 1,000 (e.g., \"1,000\", \"10,000\").\n\nExample Output (Reference this style for ALL languages):\n{\n  \"expression\": \"under the weather\",\n  \"domain\": \"conversation\",\n  \"category\": \"daily\",\n  \"meaning\": {\n    \"en\": \"not feeling well Â· feeling sick\",\n    \"ko\": \"ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ Â· ì»¨ë””ì…˜ì´ ë³„ë¡œì•¼\",\n    \"ja\": \"ä½“èª¿ãŒå°‘ã—æ‚ªã„ Â· æ°—åˆ†ãŒã™ãã‚Œãªã„\",\n    \"es\": \"sentirse un poco mal Â· no estar al cien\",\n    \"fr\": \"se sentir mal Â· Ãªtre patraque\",\n    \"de\": \"sich nicht gut fÃ¼hlen Â· angeschlagen sein\",\n    \"ru\": \"Ğ½ĞµĞ²Ğ°Ğ¶Ğ½Ğ¾ ÑĞµĞ±Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Â· Ğ¿Ñ€Ğ¸Ğ±Ğ¾Ğ»ĞµÑ‚ÑŒ\",\n    \"zh\": \"èº«ä½“ä¸èˆ’æœ Â· æ„Ÿè§‰ä¸å¤ªå¥½\",\n    \"ar\": \"Ù„Ø³Øª Ø¹Ù„Ù‰ Ù…Ø§ ÙŠØ±Ø§Ù… Â· Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ù…Ø±Ø¶\"\n  },\n  \"content\": {\n    \"en\": {\n      \"situation\": \"This is perfect for those days when you wake up feeling a bit sluggish or off. ğŸ˜± It's a great expression to say you're not 100%, but not seriously ill either! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **Fun Fact!** This idiom is said to come from sailors who would go below deck (under the weather rail) when they felt seasick during bad weather! âš“ï¸ğŸŒŠ Remember, if you are genuinely sick, it's better to say 'I'm sick' or 'I have a fever'.\",\n      \"quiz\": {\n        \"question\": \"When is the most appropriate time to use 'under the weather'?\\n\\nA. ğŸ¥³ When you are dancing happily at a party.\\nB. ğŸ˜´ When you are lying in bed feeling a bit chilly and off.\\nC. ğŸ‹ï¸â€â™€ï¸ When you are lifting weights energetically at the gym.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ko\": {\n      \"situation\": \"ğŸŒŸ ì•„ì¹¨ì— ì¼ì–´ë‚¬ëŠ”ë° ì™ ì§€ ëª¨ë¥´ê²Œ ëª¸ì´ ì¶• ì²˜ì§€ê³ , ì»¨ë””ì…˜ì´ ë³„ë¡œì¼ ë•Œ! ğŸ˜± 'ì•„, ë‚˜ ì˜¤ëŠ˜ ë­”ê°€ ì¢€ ë³„ë¡ ë°... ë³‘ë“  ë³‘ì•„ë¦¬ ê°™ì•„...' í•  ë•Œ ì“°ëŠ” í•µì¸ì‹¸ í‘œí˜„ì´ì—ìš”! ì§„ì§œ ì•„í”ˆ ê±´ ì•„ë‹Œë° ê·¸ë ‡ë‹¤ê³  ì™„ì „ ìŒ©ìŒ©í•˜ì§€ë„ ì•Šì„ ë•Œ, ê°€ë³ê²Œ ë‚´ ìƒíƒœë¥¼ ë§í•˜ê³  ì‹¶ì„ ë•Œ ì°°ë–¡ê°™ì´ ì“¸ ìˆ˜ ìˆë‹µë‹ˆë‹¤! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸš¨ **ê¿€íŒ ë°©ì¶œ!** 'under the weather'ëŠ” ì§„ì§œ ì‹¬ê°í•˜ê²Œ ì•„í”Œ ë•Œë³´ë‹¤ëŠ” ê°€ë³ê²Œ 'ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ë‹¤', 'ê°ê¸° ê¸°ìš´ì´ ìˆë‹¤' ì •ë„ì˜ ëŠë‚Œì´ì—ìš”. ğŸ˜· ë§Œì•½ ì§„ì§œ ì‹¬í•˜ê²Œ ì•„í”„ë‹¤ë©´ 'I'm sick' ë˜ëŠ” 'I have a fever'ì²˜ëŸ¼ êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”. ğŸ˜‰ ê·¸ë¦¬ê³  ì´ í‘œí˜„ì€ ë±ƒì‚¬ëŒë“¤ì´ ë°°ì—ì„œ ë‚ ì”¨ê°€ ì•ˆ ì¢‹ì„ ë•Œ ì•„í”ˆ ì‚¬ëŒì„ ê°‘íŒ ì•„ë˜ë¡œ ë³´ë‚´ 'ë‚ ì”¨ ì•„ë˜'ì— ìˆê²Œ í–ˆë‹¤ëŠ” ìœ ë˜ê°€ ìˆëŒ€ìš”! ì™„ì „ ì‹ ê¸°í•˜ì£ ? âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ë‹¤ìŒ ì¤‘ 'under the weather'ë¥¼ ì‚¬ìš©í•˜ê¸° ê°€ì¥ ì ì ˆí•œ ìƒí™©ì€?\\n\\nA. ğŸ¥³ íŒŒí‹°ì—ì„œ ì‹ ë‚˜ê²Œ ì¶¤ì¶”ê³  ìˆë‹¤.\\nB. ğŸ˜´ ì¹¨ëŒ€ì—ì„œ ë°ê¸°ì ê±°ë¦¬ë©° ëª¸ì´ ì¢€ ìœ¼ìŠ¬ìœ¼ìŠ¬í•˜ë‹¤.\\nC. ğŸ‹ï¸â€â™€ï¸ í—¬ìŠ¤ì¥ì—ì„œ ì—­ê¸°ë¥¼ ë“¤ê³  ìš´ë™í•˜ê³  ìˆë‹¤.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ja\": {\n      \"situation\": \"æœèµ·ããŸæ™‚ã«ã€ãªã‚“ã¨ãªãä½“ãŒã ã‚‹ãã¦ã€Œä»Šæ—¥ã¯ãªã‚“ã ã‹èª¿å­ãŒæ‚ªã„ãªâ€¦ã€ã¨æ„Ÿã˜ã‚‹æ™‚ã«ã´ã£ãŸã‚Šã®è¡¨ç¾ã§ã™ï¼ğŸ˜· æœ¬å½“ã«ã²ã©ã„ç—…æ°—ã§ã¯ãªã„ã‘ã‚Œã©ã€100%å…ƒæ°—ã§ã‚‚ãªã„æ™‚ã«ã€è‡ªåˆ†ã®çŠ¶æ…‹ã‚’ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ä¼ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚âœ¨\",\n      \"tip\": \"ğŸ’¡ **è±†çŸ¥è­˜!** ã“ã®è¡¨ç¾ã¯ã€æ˜”ã®èˆ¹ä¹—ã‚ŠãŒå¤©å€™ãŒæ‚ªãã¦ä½“èª¿ã‚’å´©ã—ãŸæ™‚ã«ã€ç”²æ¿ã®ä¸‹ï¼ˆUnder the deckï¼‰ã«é¿é›£ã—ãŸã“ã¨ã‹ã‚‰ã€ŒUnder the weatherã€ã«ãªã£ãŸã¨ã„ã†èª¬ãŒã‚ã‚Šã¾ã™ã€‚âš“ï¸ æœ¬å½“ã«ä½“èª¿ãŒæ‚ªã„æ™‚ã¯ã€ŒI'm sickã€ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ï¼\",\n      \"quiz\": {\n        \"question\": \"ã€Œunder the weatherã€ã‚’ä½¿ã†ã®ã«æœ€ã‚‚é©ã—ãŸçŠ¶æ³ã¯ï¼Ÿ\\n\\nA. ğŸ¥³ ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§æ¥½ã—ãè¸Šã£ã¦ã„ã‚‹ã€‚\\nB. ğŸ˜´ é¢¨é‚ªæ°—å‘³ã§ã€ãƒ™ãƒƒãƒ‰ã§ä¼‘ã‚“ã§ã„ã‚‹ã€‚\\nC. ğŸ‹ï¸â€â™€ï¸ ã‚¸ãƒ ã§å…ƒæ°—ã«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹ã€‚\",\n        \"answer\": \"B\"\n      }\n    },\n    \"es\": {\n      \"situation\": \"Â¡Cuando te despiertas y te sientes un poco cansado o sin energÃ­a! ğŸ˜± Es una expresiÃ³n muy comÃºn para decir que no te sientes al 100%, pero tampoco estÃ¡s gravemente enfermo. ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸš¨ **Â¡Dato curioso!** El origen viene de los marineros. Cuando el clima era malo y se sentÃ­an mal, bajaban debajo de la cubierta para estar 'bajo el clima'. ğŸŒŠâš“ï¸ Si estÃ¡s realmente enfermo, es mejor usar 'I'm sick'.\",\n      \"quiz\": {\n        \"question\": \"Â¿En quÃ© situaciÃ³n usarÃ­as \\\"under the weather\\\"?\\n\\nA. ğŸ¥³ En una fiesta bailando alegremente.\\nB. ğŸ˜´ Descansando en la cama porque te sientes un poco mal.\\nC. ğŸ‹ï¸â€â™€ï¸ Entrenando con mucha energÃ­a en el gimnasio.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"fr\": {\n      \"situation\": \"C'est parfait pour les jours oÃ¹ vous vous rÃ©veillez un peu mou. ğŸ˜± C'est une super expression pour dire que vous n'Ãªtes pas Ã  100%, sans Ãªtre gravement malade ! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **Le saviez-vous ?** Cette expression viendrait des marins qui descendaient sous le pont pour s'abriter du mauvais temps quand ils avaient le mal de mer ! âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Quand est-il le plus appropriÃ© d'utiliser 'under the weather' ?\\n\\nA. ğŸ¥³ Quand vous dansez joyeusement Ã  une fÃªte.\\nB. ğŸ˜´ Quand vous Ãªtes au lit et que vous vous sentez un peu fÃ©brile.\\nC. ğŸ‹ï¸â€â™€ï¸ Quand vous soulevez des poids Ã©nergiquement Ã  la salle de sport.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"de\": {\n      \"situation\": \"Perfekt fÃ¼r Tage, an denen man aufwacht und sich einfach schlapp fÃ¼hlt. ğŸ˜± Ein toller Ausdruck, um zu sagen, dass man nicht 100% fit ist, aber auch nicht ernsthaft krank! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **Schon gewusst?** Diese Redewendung stammt angeblich von Seeleuten, die bei schlechtem Wetter unter Deck gingen, wenn sie seekrank waren! âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Wann ist der beste Zeitpunkt, 'under the weather' zu verwenden?\\n\\nA. ğŸ¥³ Wenn du frÃ¶hlich auf einer Party tanzt.\\nB. ğŸ˜´ Wenn du im Bett liegst und dich etwas krÃ¤nklich fÃ¼hlst.\\nC. ğŸ‹ï¸â€â™€ï¸ Wenn du im Fitnessstudio energiegeladen Gewichte hebst.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ru\": {\n      \"situation\": \"Ğ­Ñ‚Ğ¾ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ Ñ‚ĞµÑ… Ğ´Ğ½ĞµĞ¹, ĞºĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ Ğ¿Ñ€Ğ¾ÑÑ‹Ğ¿Ğ°ĞµÑ‚ĞµÑÑŒ Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾Ğ¼ Ğ²ÑĞ»Ğ¾ÑÑ‚Ğ¸. ğŸ˜± ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ Ğ½Ğµ Ğ½Ğ° 100% Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğµ, Ğ½Ğ¾ Ğ¸ Ğ½Ğµ ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒĞ½Ñ‹! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **Ğ˜Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğ¹ Ñ„Ğ°ĞºÑ‚!** Ğ“Ğ¾Ğ²Ğ¾Ñ€ÑÑ‚, Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ° Ğ¸Ğ´Ğ¸Ğ¾Ğ¼Ğ° Ğ¿Ğ¾ÑˆĞ»Ğ° Ğ¾Ñ‚ Ğ¼Ğ¾Ñ€ÑĞºĞ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑĞ¿ÑƒÑĞºĞ°Ğ»Ğ¸ÑÑŒ Ğ¿Ğ¾Ğ´ Ğ¿Ğ°Ğ»ÑƒĞ±Ñƒ (under the weather rail), ĞºĞ¾Ğ³Ğ´Ğ° Ğ¸Ñ… ÑƒĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ»Ğ¾ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ ÑˆÑ‚Ğ¾Ñ€Ğ¼Ğ°! âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ĞšĞ¾Ğ³Ğ´Ğ° ÑƒĞ¼ĞµÑÑ‚Ğ½ĞµĞµ Ğ²ÑĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ 'under the weather'?\\n\\nA. ğŸ¥³ ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ Ñ€Ğ°Ğ´Ğ¾ÑÑ‚Ğ½Ğ¾ Ñ‚Ğ°Ğ½Ñ†ÑƒĞµÑ‚Ğµ Ğ½Ğ° Ğ²ĞµÑ‡ĞµÑ€Ğ¸Ğ½ĞºĞµ.\\nB. ğŸ˜´ ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ Ğ»ĞµĞ¶Ğ¸Ñ‚Ğµ Ğ² ĞºÑ€Ğ¾Ğ²Ğ°Ñ‚Ğ¸ Ğ¸ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚Ğµ Ğ»ĞµĞ³ĞºĞ¾Ğµ Ğ½ĞµĞ´Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ğ½Ğ¸Ğµ.\\nC. ğŸ‹ï¸â€â™€ï¸ ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚Ğµ Ñ‚ÑĞ¶ĞµÑÑ‚Ğ¸ Ğ² ÑĞ¿Ğ¾Ñ€Ñ‚Ğ·Ğ°Ğ»Ğµ.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"zh\": {\n      \"situation\": \"å½“ä½ æ—©ä¸Šé†’æ¥æ„Ÿè§‰æœ‰ç‚¹æ²¡ç²¾ç¥æˆ–è€…ä¸èˆ’æœçš„æ—¶å€™ï¼Œç”¨è¿™ä¸ªè¯å†åˆé€‚ä¸è¿‡äº†ï¼ğŸ˜± è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¨è¾¾ï¼Œç”¨æ¥å½¢å®¹ä½ çŠ¶æ€ä¸æ˜¯100%å¥½ï¼Œä½†ä¹Ÿæ²¡ç”Ÿä»€ä¹ˆå¤§ç—…ï¼ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **å†·çŸ¥è¯†ï¼** æ®è¯´è¿™å¥ä¹ è¯­æºäºæ°´æ‰‹ï¼Œå½“é‡åˆ°æ¶åŠ£å¤©æ°”æ„Ÿåˆ°æ™•èˆ¹æ—¶ï¼Œä»–ä»¬ä¼šèº²åˆ°ç”²æ¿ä¸‹é¢ï¼ˆunder the weather railï¼‰ï¼âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ä»€ä¹ˆæ—¶å€™æœ€é€‚åˆä½¿ç”¨ 'under the weather'ï¼Ÿ\\n\\nA. ğŸ¥³ å½“ä½ åœ¨æ´¾å¯¹ä¸Šå¼€å¿ƒåœ°è·³èˆæ—¶ã€‚\\nB. ğŸ˜´ å½“ä½ èººåœ¨åºŠä¸Šæ„Ÿè§‰æœ‰ç‚¹å‘å†·ä¸èˆ’æœæ—¶ã€‚\\nC. ğŸ‹ï¸â€â™€ï¸ å½“ä½ åœ¨å¥èº«æˆ¿ç²¾åŠ›å……æ²›åœ°ä¸¾é‡æ—¶ã€‚\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ar\": {\n      \"situation\": \"Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ ØªØ³ØªÙŠÙ‚Ø¸ ÙÙŠÙ‡Ø§ ÙˆØ£Ù†Øª ØªØ´Ø¹Ø± Ø¨Ø¨Ø¹Ø¶ Ø§Ù„Ø®Ù…ÙˆÙ„ Ø£Ùˆ Ø§Ù„ØªØ¹Ø¨. ğŸ˜± Ø¥Ù†Ù‡ ØªØ¹Ø¨ÙŠØ± Ø±Ø§Ø¦Ø¹ Ù„ØªÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ù„Ø³Øª ÙÙŠ ÙƒØ§Ù…Ù„ Ù„ÙŠØ§Ù‚ØªÙƒØŒ Ù„ÙƒÙ†Ùƒ Ù„Ø³Øª Ù…Ø±ÙŠØ¶Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø®Ø·ÙŠØ± Ø£ÙŠØ¶Ø§Ù‹! ğŸ¤’âœ¨\",\n      \"tip\": \"ğŸ’¡ **Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù…ØªØ¹Ø©!** ÙŠÙ‚Ø§Ù„ Ø¥Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ·Ù„Ø­ Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø­Ø§Ø±Ø© Ø§Ù„Ø°ÙŠÙ† ÙƒØ§Ù†ÙˆØ§ ÙŠÙ†Ø²Ù„ÙˆÙ† ØªØ­Øª Ø³Ø·Ø­ Ø§Ù„Ø³ÙÙŠÙ†Ø© (ØªØ­Øª Ø­Ø§Ø¬Ø² Ø§Ù„Ø·Ù‚Ø³) Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ´Ø¹Ø±ÙˆÙ† Ø¨Ø¯ÙˆØ§Ø± Ø§Ù„Ø¨Ø­Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø³ÙŠØ¦! âš“ï¸ğŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Ù…ØªÙ‰ ÙŠÙƒÙˆÙ† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø¨Ø§Ø±Ø© 'under the weather'ØŸ\\n\\nA. ğŸ¥³ Ø¹Ù†Ø¯Ù…Ø§ ØªØ±Ù‚Øµ Ø¨Ø³Ø¹Ø§Ø¯Ø© ÙÙŠ Ø­ÙÙ„Ø©.\\nB. ğŸ˜´ Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ù…Ø³ØªÙ„Ù‚ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø±ÙŠØ± ÙˆØªØ´Ø¹Ø± Ø¨Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ø±ÙˆØ¯Ø© ÙˆØ§Ù„ØªÙˆØ¹Ùƒ.\\nC. ğŸ‹ï¸â€â™€ï¸ Ø¹Ù†Ø¯Ù…Ø§ ØªØ±ÙØ¹ Ø§Ù„Ø£Ø«Ù‚Ø§Ù„ Ø¨Ù†Ø´Ø§Ø· ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©.\",\n        \"answer\": \"B\"\n      }\n    }\n  },\n  \"dialogue\": [\n    {\n      \"role\": \"A\",\n      \"en\": \"Hey, you look a bit down. Are you okay?\",\n      \"translations\": {\n        \"ko\": \"ì €ê¸°, ì¢€ ê¸°ë¶„ì´ ì•ˆ ì¢‹ì•„ ë³´ì´ëŠ”ë°. ê´œì°®ì•„ìš”?\",\n        \"ja\": \"ã­ãˆã€ãªã‚“ã ã‹å…ƒæ°—ãŒãªã„ã¿ãŸã„ã ã‘ã©å¤§ä¸ˆå¤«ï¼Ÿ\",\n        \"es\": \"Oye, te ves un poco desanimado. Â¿EstÃ¡s bien?\",\n        \"fr\": \"HÃ©, tu as l'air un peu dÃ©primÃ©. Ã‡a va ?\",\n        \"de\": \"Hey, du siehst ein bisschen niedergeschlagen aus. Alles okay?\",\n        \"ru\": \"Ğ­Ğ¹, Ñ‚Ñ‹ Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸ÑˆÑŒ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼. Ğ¢Ñ‹ Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ?\",\n        \"zh\": \"å˜¿ï¼Œä½ çœ‹èµ·æ¥æœ‰ç‚¹æ²®ä¸§ã€‚ä½ è¿˜å¥½å—ï¼Ÿ\",\n        \"ar\": \"Ù…Ù‡Ù„Ø§Ù‹ØŒ ØªØ¨Ø¯Ùˆ Ù…Ø­Ø¨Ø·Ø§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ø¨Ø®ÙŠØ±ØŸ\"\n      }\n    },\n    {\n      \"role\": \"B\",\n      \"en\": \"I'm feeling a bit under the weather today, so I think I'll just head home early.\",\n      \"translations\": {\n        \"ko\": \"ì˜¤ëŠ˜ ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ì„œ, ì¼ì° ì§‘ì— ê°€ë ¤ê³ ìš”.\",\n        \"ja\": \"ä»Šæ—¥ã¯ã¡ã‚‡ã£ã¨ä½“èª¿ãŒæ‚ªã„ã®ã§ã€æ—©ã‚ã«å¸°ã‚ã†ã¨æ€ã„ã¾ã™ã€‚\",\n        \"es\": \"Hoy me siento un poco mal, asÃ­ que creo que me irÃ© a casa temprano.\",\n        \"fr\": \"Je ne me sens pas trÃ¨s bien aujourd'hui, donc je pense que je vais rentrer plus tÃ´t.\",\n        \"de\": \"Ich fÃ¼hle mich heute etwas angeschlagen, deshalb werde ich wohl frÃ¼her nach Hause gehen.\",\n        \"ru\": \"Ğ¯ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ½ĞµĞ²Ğ°Ğ¶Ğ½Ğ¾ ÑĞµĞ±Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒÑ, Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ´ÑƒĞ¼Ğ°Ñ Ğ¿Ğ¾Ğ¹Ñ‚Ğ¸ Ğ´Ğ¾Ğ¼Ğ¾Ğ¹ Ğ¿Ğ¾Ñ€Ğ°Ğ½ÑŒÑˆĞµ.\",\n        \"zh\": \"æˆ‘ä»Šå¤©èº«ä½“æœ‰ç‚¹ä¸èˆ’æœï¼Œæƒ³æ—©ç‚¹å›å®¶ã€‚\",\n        \"ar\": \"Ø£Ø´Ø¹Ø± Ø¨ØªÙˆØ¹Ùƒ Ù‚Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ØŒ Ù„Ø°Ø§ Ø³Ø£Ø¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¨ÙƒØ±Ø§Ù‹.\"\n      }\n    }\n  ],\n  \"tags\": [\"daily\", \"health\", \"lifestyle\"]\n}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [192, -320],
      "id": "5e84d2f0-2582-4a56-b80c-fd9cb894c584",
      "name": "Gemini Master Generator",
      "executeOnce": true
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Parse Gemini JSON Response\n// Geminiì˜ ì‘ë‹µ í…ìŠ¤íŠ¸ì—ì„œ ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ì„ ì œê±°í•˜ê³  ê¹¨ë—í•œ JSON ê°ì²´ë¡œ íŒŒì‹±í•©ë‹ˆë‹¤.\n\nconst items = $input.all();\nconst results = [];\n\nitems.forEach((item) => {\n    const rawText = item.json.text || \"\";\n\n    // ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡(```json ... ```) ë° ë°±í‹± ì œê±°\n    const cleanJson = rawText\n        .replace(/```json/g, \"\")\n        .replace(/```/g, \"\")\n        .trim();\n\n    try {\n        const parsedData = JSON.parse(cleanJson);\n        results.push({\n            json: parsedData\n        });\n    } catch (error) {\n        // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë””ë²„ê¹…ì„ ìœ„í•œ ì›ë³¸ í…ìŠ¤íŠ¸ ë° ì—ëŸ¬ ì •ë³´ ë°˜í™˜\n        results.push({\n            json: {\n                error: \"JSON Parsing Failed\",\n                message: error.message,\n                raw_text: rawText\n            }\n        });\n    }\n});\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [480, -320],
      "id": "d9f50012-3927-4d64-a4d2-1578a156ac70",
      "name": "Parse Master JSON"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "437133fd-c1a0-47c2-8b2b-1da38a88c30f",
              "leftValue": "={{ $json.error !== undefined }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [848, -320],
      "id": "f51f4288-e433-40a6-888b-6868a6e47daa",
      "name": "If Error"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Cleanup Meaning\n// meaning í•„ë“œì˜ ë¬¸ì¥ ë¶€í˜¸(ë§ˆì¹¨í‘œ, ì„¸ë¯¸ì½œë¡ )ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤.\n\nconst items = $input.all();\nconst TARGET_LANGS = [\"en\", \"ko\", \"ja\", \"es\", \"fr\", \"de\", \"ru\", \"zh\", \"ar\"];\n\nitems.forEach((item) => {\n  const data = item.json;\n\n  if (data.meaning) {\n    TARGET_LANGS.forEach((lang) => {\n      let text = data.meaning[lang];\n      if (typeof text === \"string\") {\n        // 1. ë§ˆì¹¨í‘œ(.) ì œê±° (ë¬¸ì¥ ì¤‘ê°„ í¬í•¨, ...ì€ ì œì™¸)\n        // ë§ì¤„ì„í‘œ(...) ë³´ì¡´ì„ ìœ„í•´ ì„ì‹œ ì¹˜í™˜\n        const tempEllipsis = \"___ELLIPSIS___\";\n        text = text.replace(/\\.\\.\\./g, tempEllipsis);\n\n        // ëª¨ë“  ë§ˆì¹¨í‘œ ì œê±°\n        text = text.replace(/\\./g, \"\");\n\n        // ë§ì¤„ì„í‘œ ë³µì›\n        text = text.replace(new RegExp(tempEllipsis, \"g\"), \"...\");\n\n        // 2. ì„¸ë¯¸ì½œë¡ (;)ì„ ' Â· 'ë¡œ ë³€ê²½\n        // ref.json ì˜ˆì‹œ: \"suitable Â· appropriate Â· compatible\"\n        // ì•ë’¤ ê³µë°±ì„ í™•ë³´í•˜ê¸° ìœ„í•´ \" Â· \"ë¡œ ì¹˜í™˜\n        text = text.replace(/;/g, \" Â· \");\n\n        // ì¤‘ë³µ ê³µë°± ì œê±° ( \" Â·  \" -> \" Â· \" )\n        text = text.replace(/\\s+Â·\\s+/g, \" Â· \");\n\n        data.meaning[lang] = text;\n      }\n    });\n  }\n});\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [480, -64],
      "id": "d9561502-e698-49f5-a1c3-7a5a67c22298",
      "name": "Cleanup Meaning"
    }
  ],
  "pinData": {},
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Master Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pick Category": {
      "main": [
        [
          {
            "node": "Get Existing Expressions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate": {
      "main": [
        [
          {
            "node": "If New",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If New": {
      "main": [
        [
          {
            "node": "Generate ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Existing Expressions": {
      "main": [
        [
          {
            "node": "Gemini Master Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate ID": {
      "main": [
        [
          {
            "node": "Prepare TTS Requests",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare TTS Requests": {
      "main": [
        [
          {
            "node": "Groq Orpheus TTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Orpheus TTS": {
      "main": [
        [
          {
            "node": "Upload to Storage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Storage": {
      "main": [
        [
          {
            "node": "Aggregate TTS Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate TTS Results": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Content": {
      "main": [
        [
          {
            "node": "If Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop": {
      "main": [
        [],
        [
          {
            "node": "Pick Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Pick Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Insert": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Generate 10 Loops",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate 10 Loops": {
      "main": [
        [
          {
            "node": "Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Master Generator": {
      "main": [
        [
          {
            "node": "Parse Master JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Master JSON": {
      "main": [
        [
          {
            "node": "Cleanup Meaning",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Error": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Duplicate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cleanup Meaning": {
      "main": [
        [
          {
            "node": "Validate Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "3b6e475f-0c28-4445-abeb-c26f58b737f2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "44eccdfd3d6ceb66b2583823800b36baa2414bca9365757e5e9e074681b0e0e7"
  },
  "id": "PJUarvvccV7YbcGI",
  "tags": [
    {
      "updatedAt": "2026-01-12T10:27:54.784Z",
      "createdAt": "2026-01-12T10:27:54.784Z",
      "id": "EKiM9LWCJyMzr7vn",
      "name": "v1"
    },
    {
      "updatedAt": "2026-01-12T00:31:37.108Z",
      "createdAt": "2026-01-12T00:31:37.108Z",
      "id": "dpGmGezKoO6rqCKI",
      "name": "Speak Mango"
    }
  ]
}
