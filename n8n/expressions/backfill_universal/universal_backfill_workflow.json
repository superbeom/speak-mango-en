{
    "name": "Speak Mango - Backfill Multi-Language Content (Loop + Rate Limit)",
    "nodes": [
        {
            "parameters": {},
            "id": "manual-trigger",
            "name": "Manual Trigger",
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
                -320,
                -144
            ]
        },
        {
            "parameters": {
                "operation": "getAll",
                "schema": {
                    "__rl": true,
                    "value": "speak_mango_en",
                    "mode": "list",
                    "cachedResultName": "speak_mango_en"
                },
                "tableId": {
                    "__rl": true,
                    "value": "expressions",
                    "mode": "list",
                    "cachedResultName": "expressions"
                },
                "returnAll": true,
                "filters": {
                    "conditions": [
                        {
                            "keyName": "meaning",
                            "condition": "notEmpty"
                        }
                    ]
                }
            },
            "id": "supabase-get-all",
            "name": "Supabase Get All",
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                -100,
                -144
            ],
            "credentials": {
                "supabaseApi": {
                    "id": "your-supabase-api-id",
                    "name": "Supabase account"
                }
            }
        },
        {
            "parameters": {
                "conditions": {
                    "boolean": [
                        {
                            "value1": "={{ $json.content.en }}",
                            "operator": "isNotEmpty"
                        }
                    ]
                }
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                20,
                -144
            ],
            "id": "filter-processed",
            "name": "Filter Processed (en missing)"
        },
        {
            "parameters": {
                "batchSize": 1,
                "options": {}
            },
            "id": "split-in-batches",
            "name": "Split In Batches",
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 2,
            "position": [
                180,
                -144
            ]
        },
        {
            "parameters": {
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
            "typeVersion": 1,
            "position": [
                240,
                80
            ],
            "id": "gemini-model",
            "name": "Google Gemini Chat Model",
            "credentials": {
                "googlePalmApi": {
                    "id": "your-gemini-api-id",
                    "name": "Google Gemini(PaLM) Api account"
                }
            }
        },
        {
            "parameters": {
                "promptType": "define",
                "text": "=Role: Professional English Content Creator & Polyglot Teacher.\nTask: Create a detailed study card for the following English expression in these languages: **English (en), Korean (ko), Japanese (ja), Spanish (es), French (fr), German (de), Russian (ru), Chinese (zh), and Arabic (ar)**.\n\nExpression: {{ $json.expression }}\nDomain: {{ $json.domain }}\nCategory: {{ $json.category }}\n\n**Reference Style (Korean):**\nTip: {{ $json.content.ko.tip }}\nSituation: {{ $json.content.ko.situation }}\n\nRequirements:\n1. Tone: Friendly, humorous, and engaging (target audience: 20-30s), BUT **MUST use polite language consistently** for explanations.\n    - **English**: Use **Standard English** (Friendly, conversational, yet educational).\n    - **Korean**: Use **ì¡´ëŒ“ë§ (Jondaetmal)**.\n    - **Japanese**: Use **Desu-Masu Form (ä¸å¯§èªž)**.\n    - **Spanish**: Use **'TÃº' form** but keep it respectful and professional.\n    - **French**: Use **'Tu' form** for engagement but maintain a polite, helpful tone (or 'Vous' if context demands strict formality, but 'Tu' is preferred for 20-30s friendly content).\n    - **German**: Use **'Du' form** (friendly, for 20-30s audience).\n    - **Russian**: Use **'Ð’Ñ‹' (Polite)** for general explanations to maintain authority, or **'Ñ‚Ñ‹'** if very casual. (Stick to **Friendly 'Ð’Ñ‹'** or respectful **'Ñ‚Ñ‹'**). Let's use **Friendly 'Ð¢Ñ‹'** for this target audience (20-30s blog style).\n    - **Chinese**: Use **Polite yet friendly (ä½  + æ•¬è¯­/Polite particles)**.\n    - **Arabic**: Use **Modern Standard Arabic (MSA)** but with a friendly, accessible tone (avoid overly archaic vocabulary).\n\n2. For the 'meaning' field in ALL languages:\n   - **Tone**: Use a **casual tone** by default.\n     - **Korean**: Use **ë°˜ë§ (Banmal)**.\n     - **Japanese**: Use **Plain Form (Tameguchi/ã‚¿ãƒ¡å£)**.\n     - **Spanish**: Use **Informal 'TÃº' form**.\n     - **French**: Use **Informal 'Tu' form**.\n     - **German**: Use **Informal 'Du' form**.\n     - **Russian**: Use **Informal 'Ñ‚Ñ‹' form**.\n     - **Chinese**: Use **Casual speech**.\n     - **Arabic**: Use **MSA** (simplified).\n   - **EXCEPTION**: If the English expression is formal or typically used in a polite situation (e.g., \"Could I...\", \"May I...\", business emails, addressing a superior), use a **polite tone** in all languages.\n     - **Korean**: ì¡´ëŒ“ë§ (Jondaetmal).\n     - **Japanese**: Desu-Masu Form (ä¸å¯§èªž).\n     - **Spanish**: Formal 'Usted' form.\n     - **French**: Formal 'Vous' form.\n     - **German**: Formal 'Sie' form.\n     - **Russian**: Formal 'Ð’Ñ‹' form.\n     - **Chinese**: Polite speech (using 'æ‚¨' instead of 'ä½ ').\n     - **Arabic**: Formal MSA (Fusha).\n   - For English (en) meaning: Provide a simple, clear definition or synonym in English.\n   - **Punctuation**: If the English expression is a question (?), the meaning MUST also end with a question mark (?) or be phrased as a question. Do NOT use trailing periods (.) for statements.\n   - If there are multiple meanings, separate them with ' Â· ' (middle dot).\n3. Formatting for 'expression':\n   - **Capitalization**: **Start with an UPPERCASE letter** if the expression is a standalone sentence or interjection (e.g., \"No worries\", \"Never mind\", \"Don't take it personally\"). **Start with a lowercase letter** ONLY if it is a phrase or idiom used within a sentence (e.g., \"spill the tea\", \"hit the road\").\n   - Punctuation: Do NOT include trailing periods (.) or commas (,). Exclamation marks (!) and question marks (?) are allowed.\n4. Constraint for content:\n   - **NEVER use casual speech** in the explanation, tips, dialogue, or situation description (except for the 'meaning' field).\n     - **English**: Avoid text-speak (e.g., \"u\", \"r\") or excessive slang in explanations; keep it clear and accessible.\n     - **Korean**: No ë°˜ë§ (Banmal).\n     - **Japanese**: No Plain Form (Tameguchi).\n     - **Spanish/French/German/Russian**: Maintain a helpful, teacher-like tone (avoid overly colloquial slang in the explanation text itself).\n   - Do NOT mix polite and casual styles. Keep the tone consistent throughout.\n   - Do NOT address the reader as specific groups like \"Kids\" or \"Students\". Use a general, relatable tone suitable for young adults.\n5. Output MUST be a valid JSON object matching the schema below.\n6. 'meaning' and 'content' fields must contain keys for **en, ko, ja, es, fr, de, ru, zh, ar**.\n7. **Dialogue & Roles (CRITICAL)**:\n   - The `dialogue` field is a **TOP-LEVEL array** (sibling to `meaning` and `content`), NOT inside `content`.\n   - Create a **coherent, natural conversation** between two people (A and B).\n   - **The dialogue MUST consist of 2 or 3 turns (A -> B or A -> B -> A).**\n   - Ensure natural interaction where either speaker can use the target expression in a meaningful context (not limited to a Q&A pattern).\n   - Each entry in the `dialogue` array MUST include:\n     - `\"role\"`: Value \"A\" or \"B\" to distinguish speakers.\n     - `\"en\"`: The English sentence.\n     - `\"translations\"`: An object containing `\"ko\"`, `\"ja\"`, `\"es\"`, `\"fr\"`, `\"de\"`, `\"ru\"`, `\"zh\"`, `\"ar\"` translations of the English sentence.\n8. **Consistency**: Use the 'Example (Korean)' below as a reference for the depth, humor, and style. Apply the same quality to English, Japanese, Spanish, French, German, Russian, Chinese, and Arabic.\n9. **Fixed Fields**: Include the 'domain' and 'category' exactly as provided in the input.\n10. **Quiz Logic (CRITICAL)**:\n    - The quiz must test the understanding of the English expression.\n    - **Randomly select one of the following patterns**:\n      - **Pattern 1 (Situation -> English)**: Describe a situation in [Target Language] and ask \"Which English expression fits this situation?\". -> The options (A, B, C) MUST be **English expressions**.\n        *   *Example (Target Language: ko)*: Q: \"ì¹œêµ¬ê°€ \\\"ì´ë²ˆ ì£¼ë§ì— ì˜í™” ë³¼ê¹Œìš”?\\\"ë¼ê³  ì œì•ˆí–ˆì„ ë•Œ, ê¸ì •ì ìœ¼ë¡œ ë™ì˜í•˜ëŠ” ê°€ìž¥ ìžì—°ìŠ¤ëŸ¬ìš´ ì˜ì–´ í‘œí˜„ì€?\\n\\nA. Sounds bad\\nB. Sounds good\\nC. Sounds angry\"\n      - **Pattern 2 (Expression -> Situation)**: Show the expression and ask \"When would you use this?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"ë‹¤ìŒ ì¤‘ 'What's up?'ì„ ê°€ìž¥ ìžì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ìƒí™©ì€?\\n\\nA. ðŸ’° ì€í–‰ì—ì„œ ëŒ€ì¶œ ìƒë‹´ì„ ë°›ê³  ìžˆë‹¤.\\nB. ðŸš€ íšŒì‚¬ ì¤‘ì—­ íšŒì˜ì—ì„œ ë°œí‘œë¥¼ ì‹œìž‘í•œë‹¤.\\nC. ðŸš¶â€â™€ï¸ ê¸¸ì„ ê±·ë‹¤ê°€ ì¹œêµ¬ì™€ ëˆˆì´ ë§ˆì£¼ì³¤ë‹¤.\"\n      - **Pattern 3 (Negative Logic)**: Ask \"Which situation is **NOT** appropriate for this expression?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"ë‹¤ìŒ ì¤‘ 'Let's touch base.'ì˜ ì‚¬ìš©ì´ ì ì ˆí•˜ì§€ ì•Šì€ ìƒí™©ì€?\\n\\nA. ðŸ™‹â€â™€ï¸ íŒ€ì›ê³¼ ì£¼ê°„ ë³´ê³ ì„œì— ëŒ€í•´ ì§§ê²Œ ì´ì•¼ê¸°í•  ë•Œ.\\nB. ðŸ¥³ ì¹œêµ¬ë“¤ê³¼ ì£¼ë§ì— ë†€ëŸ¬ ê°ˆ ê³„íšì„ ì„¸ìš¸ ë•Œ.\\nC. ðŸ§‘â€ðŸ’» ê³ ê°ê³¼ ë‹¤ìŒ ë‹¨ê³„ ë…¼ì˜ë¥¼ ìœ„í•´ ì—°ë½í•  ë•Œ.\"\n    - **Strict Formatting & Validation Rules**:\n      1. **These rules apply to ALL languages (en, ko, ja, es).**\n      2. You **MUST** provide 3 distinct options labeled A, B, and C.\n      3. You **MUST** use `\\n` (newline) to separate the question and each option.\n      4. The 'answer' field MUST be **only the uppercase letter** (e.g., \"A\", \"B\", \"C\"). **NEVER** include the full text of the answer.\n      5. **Randomize the correct answer position**: The correct answer MUST be randomly assigned to A, B, or C. Do NOT default to 'B'. ensure equal distribution of A, B, and C across different generations.\n11. **Tags (MANDATORY)**: Include a `\"tags\"` field containing an array of 3 to 5 lowercase strings. These tags should be relevant keywords that help categorize the expression (e.g., \"idiom\", \"office\", \"slang\", \"travel\"). Do NOT include the '#' symbol.\n12. **Currency & Numbers**:\n    - Always use **`$` (USD)** for currency to maintain consistency (e.g., \"$10\", \"$50.50\"). Do not use other currencies like 'won', 'yen', or 'euro' unless the expression specifically requires it.\n    - Use commas for numbers larger than 1,000 (e.g., \"1,000\", \"10,000\").\n\nExample Output (Reference this style for ALL languages):\n{\n  \"expression\": \"under the weather\",\n  \"domain\": \"conversation\",\n  \"category\": \"daily\",\n  \"meaning\": {\n    \"en\": \"not feeling well Â· feeling sick\",\n    \"ko\": \"ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ Â· ì»¨ë””ì…˜ì´ ë³„ë¡œì•¼\",\n    \"ja\": \"ä½“èª¿ãŒå°‘ã—æ‚ªã„ Â· æ°—åˆ†ãŒã™ãã‚Œãªã„\",\n    \"es\": \"sentirse un poco mal Â· no estar al cien\",\n    \"fr\": \"se sentir mal Â· Ãªtre patraque\",\n    \"de\": \"sich nicht gut fÃ¼hlen Â· angeschlagen sein\",\n    \"ru\": \"Ð½ÐµÐ²Ð°Ð¶Ð½Ð¾ ÑÐµÐ±Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Â· Ð¿Ñ€Ð¸Ð±Ð¾Ð»ÐµÑ‚ÑŒ\",\n    \"zh\": \"èº«ä½“ä¸èˆ’æœ Â· æ„Ÿè§‰ä¸å¤ªå¥½\",\n    \"ar\": \"Ù„Ø³Øª Ø¹Ù„Ù‰ Ù…Ø§ ÙŠØ±Ø§Ù… Â· Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ù…Ø±Ø¶\"\n  },\n  \"content\": {\n    \"en\": {\n      \"situation\": \"This is perfect for those days when you wake up feeling a bit sluggish or off. ðŸ˜± It's a great expression to say you're not 100%, but not seriously ill either! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **Fun Fact!** This idiom is said to come from sailors who would go below deck (under the weather rail) when they felt seasick during bad weather! âš“ï¸ðŸŒŠ Remember, if you are genuinely sick, it's better to say 'I'm sick' or 'I have a fever'.\",\n      \"quiz\": {\n        \"question\": \"When is the most appropriate time to use 'under the weather'?\\n\\nA. ðŸ¥³ When you are dancing happily at a party.\\nB. ðŸ˜´ When you are lying in bed feeling a bit chilly and off.\\nC. ðŸ‹ï¸â€â™€ï¸ When you are lifting weights energetically at the gym.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ko\": {\n      \"situation\": \"ðŸŒŸ ì•„ì¹¨ì— ì¼ì–´ë‚¬ëŠ”ë° ì™ ì§€ ëª¨ë¥´ê²Œ ëª¸ì´ ì¶• ì²˜ì§€ê³ , ì»¨ë””ì…˜ì´ ë³„ë¡œì¼ ë•Œ! ðŸ˜± 'ì•„, ë‚˜ ì˜¤ëŠ˜ ë­”ê°€ ì¢€ ë³„ë¡ ë°... ë³‘ë“  ë³‘ì•„ë¦¬ ê°™ì•„...' í•  ë•Œ ì“°ëŠ” í•µì¸ì‹¸ í‘œí˜„ì´ì—ìš”! ì§„ì§œ ì•„í”ˆ ê±´ ì•„ë‹Œë° ê·¸ë ‡ë‹¤ê³  ì™„ì „ ìŒ©ìŒ©í•˜ì§€ë„ ì•Šì„ ë•Œ, ê°€ë³ê²Œ ë‚´ ìƒíƒœë¥¼ ë§í•˜ê³  ì‹¶ì„ ë•Œ ì°°ë–¡ê°™ì´ ì“¸ ìˆ˜ ìžˆë‹µë‹ˆë‹¤! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸš¨ **ê¿€íŒ ë°©ì¶œ!** 'under the weather'ëŠ” ì§„ì§œ ì‹¬ê°í•˜ê²Œ ì•„í”Œ ë•Œë³´ë‹¤ëŠ” ê°€ë³ê²Œ 'ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ë‹¤', 'ê°ê¸° ê¸°ìš´ì´ ìžˆë‹¤' ì •ë„ì˜ ëŠë‚Œì´ì—ìš”. ðŸ˜· ë§Œì•½ ì§„ì§œ ì‹¬í•˜ê²Œ ì•„í”„ë‹¤ë©´ 'I'm sick' ë˜ëŠ” 'I have a fever'ì²˜ëŸ¼ êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”. ðŸ˜‰ ê·¸ë¦¬ê³  ì´ í‘œí˜„ì€ ë±ƒì‚¬ëžŒë“¤ì´ ë°°ì—ì„œ ë‚ ì”¨ê°€ ì•ˆ ì¢‹ì„ ë•Œ ì•„í”ˆ ì‚¬ëžŒì„ ê°‘íŒ ì•„ëž˜ë¡œ ë³´ë‚´ 'ë‚ ì”¨ ì•„ëž˜'ì— ìžˆê²Œ í–ˆë‹¤ëŠ” ìœ ëž˜ê°€ ìžˆëŒ€ìš”! ì™„ì „ ì‹ ê¸°í•˜ì£ ? âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ë‹¤ìŒ ì¤‘ 'under the weather'ë¥¼ ì‚¬ìš©í•˜ê¸° ê°€ìž¥ ì ì ˆí•œ ìƒí™©ì€?\\n\\nA. ðŸ¥³ íŒŒí‹°ì—ì„œ ì‹ ë‚˜ê²Œ ì¶¤ì¶”ê³  ìžˆë‹¤.\\nB. ðŸ˜´ ì¹¨ëŒ€ì—ì„œ ë°ê¸°ì ê±°ë¦¬ë©° ëª¸ì´ ì¢€ ìœ¼ìŠ¬ìœ¼ìŠ¬í•˜ë‹¤.\\nC. ðŸ‹ï¸â€â™€ï¸ í—¬ìŠ¤ìž¥ì—ì„œ ì—­ê¸°ë¥¼ ë“¤ê³  ìš´ë™í•˜ê³  ìžˆë‹¤.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ja\": {\n      \"situation\": \"æœèµ·ããŸæ™‚ã«ã€ãªã‚“ã¨ãªãä½“ãŒã ã‚‹ãã¦ã€Œä»Šæ—¥ã¯ãªã‚“ã ã‹èª¿å­ãŒæ‚ªã„ãªâ€¦ã€ã¨æ„Ÿã˜ã‚‹æ™‚ã«ã´ã£ãŸã‚Šã®è¡¨ç¾ã§ã™ï¼ðŸ˜· æœ¬å½“ã«ã²ã©ã„ç—…æ°—ã§ã¯ãªã„ã‘ã‚Œã©ã€100%å…ƒæ°—ã§ã‚‚ãªã„æ™‚ã«ã€è‡ªåˆ†ã®çŠ¶æ…‹ã‚’ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ä¼ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚âœ¨\",\n      \"tip\": \"ðŸ’¡ **è±†çŸ¥è­˜!** ã“ã®è¡¨ç¾ã¯ã€æ˜”ã®èˆ¹ä¹—ã‚ŠãŒå¤©å€™ãŒæ‚ªãã¦ä½“èª¿ã‚’å´©ã—ãŸæ™‚ã«ã€ç”²æ¿ã®ä¸‹ï¼ˆUnder the deckï¼‰ã«é¿é›£ã—ãŸã“ã¨ã‹ã‚‰ã€ŒUnder the weatherã€ã«ãªã£ãŸã¨ã„ã†èª¬ãŒã‚ã‚Šã¾ã™ã€‚âš“ï¸ æœ¬å½“ã«ä½“èª¿ãŒæ‚ªã„æ™‚ã¯ã€ŒI'm sickã€ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ï¼\",\n      \"quiz\": {\n        \"question\": \"ã€Œunder the weatherã€ã‚’ä½¿ã†ã®ã«æœ€ã‚‚é©ã—ãŸçŠ¶æ³ã¯ï¼Ÿ\\n\\nA. ðŸ¥³ ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§æ¥½ã—ãè¸Šã£ã¦ã„ã‚‹ã€‚\\nB. ðŸ˜´ é¢¨é‚ªæ°—å‘³ã§ã€ãƒ™ãƒƒãƒ‰ã§ä¼‘ã‚“ã§ã„ã‚‹ã€‚\\nC. ðŸ‹ï¸â€â™€ï¸ ã‚¸ãƒ ã§å…ƒæ°—ã«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹ã€‚\",\n        \"answer\": \"B\"\n      }\n    },\n    \"es\": {\n      \"situation\": \"Â¡Cuando te despiertas y te sientes un poco cansado o sin energÃ­a! ðŸ˜± Es una expresiÃ³n muy comÃºn para decir que no te sientes al 100%, pero tampoco estÃ¡s gravemente enfermo. ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸš¨ **Â¡Dato curioso!** El origen viene de los marineros. Cuando el clima era malo y se sentÃ­an mal, bajaban debajo de la cubierta para estar 'bajo el clima'. ðŸŒŠâš“ï¸ Si estÃ¡s realmente enfermo, es mejor usar 'I'm sick'.\",\n      \"quiz\": {\n        \"question\": \"Â¿En quÃ© situaciÃ³n usarÃ­as \\\"under the weather\\\"?\\n\\nA. ðŸ¥³ En una fiesta bailando alegremente.\\nB. ðŸ˜´ Descansando en la cama porque te sientes un poco mal.\\nC. ðŸ‹ï¸â€â™€ï¸ Entrenando con mucha energÃ­a en el gimnasio.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"fr\": {\n      \"situation\": \"C'est parfait pour les jours oÃ¹ vous vous rÃ©veillez un peu mou. ðŸ˜± C'est une super expression pour dire que vous n'Ãªtes pas Ã  100%, sans Ãªtre gravement malade ! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **Le saviez-vous ?** Cette expression viendrait des marins qui descendaient sous le pont pour s'abriter du mauvais temps quand ils avaient le mal de mer ! âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Quand est-il le plus appropriÃ© d'utiliser 'under the weather' ?\\n\\nA. ðŸ¥³ Quand vous dansez joyeusement Ã  une fÃªte.\\nB. ðŸ˜´ Quand vous Ãªtes au lit et que vous vous sentez un peu fÃ©brile.\\nC. ðŸ‹ï¸â€â™€ï¸ Quand vous soulevez des poids Ã©nergiquement Ã  la salle de sport.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"de\": {\n      \"situation\": \"Perfekt fÃ¼r Tage, an denen man aufwacht und sich einfach schlapp fÃ¼hlt. ðŸ˜± Ein toller Ausdruck, um zu sagen, dass man nicht 100% fit ist, aber auch nicht ernsthaft krank! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **Schon gewusst?** Diese Redewendung stammt angeblich von Seeleuten, die bei schlechtem Wetter unter Deck gingen, wenn sie seekrank waren! âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Wann ist der beste Zeitpunkt, 'under the weather' zu verwenden?\\n\\nA. ðŸ¥³ Wenn du frÃ¶hlich auf einer Party tanzt.\\nB. ðŸ˜´ Wenn du im Bett liegst und dich etwas krÃ¤nklich fÃ¼hlst.\\nC. ðŸ‹ï¸â€â™€ï¸ Wenn du im Fitnessstudio energiegeladen Gewichte hebst.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ru\": {\n      \"situation\": \"Ð­Ñ‚Ð¾ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ñ‚ÐµÑ… Ð´Ð½ÐµÐ¹, ÐºÐ¾Ð³Ð´Ð° Ð²Ñ‹ Ð¿Ñ€Ð¾ÑÑ‹Ð¿Ð°ÐµÑ‚ÐµÑÑŒ Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð¼ Ð²ÑÐ»Ð¾ÑÑ‚Ð¸. ðŸ˜± ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑÐºÐ°Ð·Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð½Ðµ Ð½Ð° 100% Ð² Ñ„Ð¾Ñ€Ð¼Ðµ, Ð½Ð¾ Ð¸ Ð½Ðµ ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾ Ð±Ð¾Ð»ÑŒÐ½Ñ‹! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ñ‹Ð¹ Ñ„Ð°ÐºÑ‚!** Ð“Ð¾Ð²Ð¾Ñ€ÑÑ‚, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð° Ð¸Ð´Ð¸Ð¾Ð¼Ð° Ð¿Ð¾ÑˆÐ»Ð° Ð¾Ñ‚ Ð¼Ð¾Ñ€ÑÐºÐ¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐ¿ÑƒÑÐºÐ°Ð»Ð¸ÑÑŒ Ð¿Ð¾Ð´ Ð¿Ð°Ð»ÑƒÐ±Ñƒ (under the weather rail), ÐºÐ¾Ð³Ð´Ð° Ð¸Ñ… ÑƒÐºÐ°Ñ‡Ð¸Ð²Ð°Ð»Ð¾ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ ÑˆÑ‚Ð¾Ñ€Ð¼Ð°! âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ÐšÐ¾Ð³Ð´Ð° ÑƒÐ¼ÐµÑÑ‚Ð½ÐµÐµ Ð²ÑÐµÐ³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ 'under the weather'?\\n\\nA. ðŸ¥³ ÐšÐ¾Ð³Ð´Ð° Ð²Ñ‹ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð½Ð¾ Ñ‚Ð°Ð½Ñ†ÑƒÐµÑ‚Ðµ Ð½Ð° Ð²ÐµÑ‡ÐµÑ€Ð¸Ð½ÐºÐµ.\\nB. ðŸ˜´ ÐšÐ¾Ð³Ð´Ð° Ð²Ñ‹ Ð»ÐµÐ¶Ð¸Ñ‚Ðµ Ð² ÐºÑ€Ð¾Ð²Ð°Ñ‚Ð¸ Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑ‚Ðµ Ð»ÐµÐ³ÐºÐ¾Ðµ Ð½ÐµÐ´Ð¾Ð¼Ð¾Ð³Ð°Ð½Ð¸Ðµ.\\nC. ðŸ‹ï¸â€â™€ï¸ ÐšÐ¾Ð³Ð´Ð° Ð²Ñ‹ ÑÐ½ÐµÑ€Ð³Ð¸Ñ‡Ð½Ð¾ Ð¿Ð¾Ð´Ð½Ð¸Ð¼Ð°ÐµÑ‚Ðµ Ñ‚ÑÐ¶ÐµÑÑ‚Ð¸ Ð² ÑÐ¿Ð¾Ñ€Ñ‚Ð·Ð°Ð»Ðµ.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"zh\": {\n      \"situation\": \"å½“ä½ æ—©ä¸Šé†’æ¥æ„Ÿè§‰æœ‰ç‚¹æ²¡ç²¾ç¥žæˆ–è€…ä¸èˆ’æœçš„æ—¶å€™ï¼Œç”¨è¿™ä¸ªè¯å†åˆé€‚ä¸è¿‡äº†ï¼ðŸ˜± è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¨è¾¾ï¼Œç”¨æ¥å½¢å®¹ä½ çŠ¶æ€ä¸æ˜¯100%å¥½ï¼Œä½†ä¹Ÿæ²¡ç”Ÿä»€ä¹ˆå¤§ç—…ï¼ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **å†·çŸ¥è¯†ï¼** æ®è¯´è¿™å¥ä¹ è¯­æºäºŽæ°´æ‰‹ï¼Œå½“é‡åˆ°æ¶åŠ£å¤©æ°”æ„Ÿåˆ°æ™•èˆ¹æ—¶ï¼Œä»–ä»¬ä¼šèº²åˆ°ç”²æ¿ä¸‹é¢ï¼ˆunder the weather railï¼‰ï¼âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"ä»€ä¹ˆæ—¶å€™æœ€é€‚åˆä½¿ç”¨ 'under the weather'ï¼Ÿ\\n\\nA. ðŸ¥³ å½“ä½ åœ¨æ´¾å¯¹ä¸Šå¼€å¿ƒåœ°è·³èˆžæ—¶.\\nB. ðŸ˜´ å½“ä½ èººåœ¨åºŠä¸Šæ„Ÿè§‰æœ‰ç‚¹å‘å†·ä¸èˆ’æœæ—¶.\\nC. ðŸ‹ï¸â€â™€ï¸ å½“ä½ åœ¨å¥èº«æˆ¿ç²¾åŠ›å……æ²›åœ°ä¸¾é‡æ—¶.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ar\": {\n      \"situation\": \"Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ ØªØ³ØªÙŠÙ‚Ø¸ ÙÙŠÙ‡Ø§ ÙˆØ£Ù†Øª ØªØ´Ø¹Ø± Ø¨Ø¨Ø¹Ø¶ Ø§Ù„Ø®Ù…ÙˆÙ„ Ø£Ùˆ Ø§Ù„ØªØ¹Ø¨. ðŸ˜± Ø¥Ù†Ù‡ ØªØ¹Ø¨ÙŠØ± Ø±Ø§Ø¦Ø¹ Ù„ØªÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ù„Ø³Øª ÙÙŠ ÙƒØ§Ù…Ù„ Ù„ÙŠØ§Ù‚ØªÙƒØŒ Ù„ÙƒÙ†Ùƒ Ù„Ø³Øª Ù…Ø±ÙŠØ¶Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø®Ø·ÙŠØ± Ø£ÙŠØ¶Ø§Ù‹! ðŸ¤’âœ¨\",\n      \"tip\": \"ðŸ’¡ **Ø­Ù‚ÙŠÙ‚Ø© Ù…Ù…ØªØ¹Ø©!** ÙŠÙ‚Ø§Ù„ Ø¥Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ·Ù„Ø­ Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø­Ø§Ø±Ø© Ø§Ù„Ø°ÙŠÙ† ÙƒØ§Ù†ÙˆØ§ ÙŠÙ†Ø²Ù„ÙˆÙ† ØªØ­Øª Ø³Ø·Ø­ Ø§Ù„Ø³ÙÙŠÙ†Ø© (ØªØ­Øª Ø­Ø§Ø¬Ø² Ø§Ù„Ø·Ù‚Ø³) Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ´Ø¹Ø±ÙˆÙ† Ø¨Ø¯ÙˆØ§Ø± Ø§Ù„Ø¨Ø­Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø³ÙŠØ¦! âš“ï¸ðŸŒŠ\",\n      \"quiz\": {\n        \"question\": \"Ù…ØªÙ‰ ÙŠÙƒÙˆÙ† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø¨Ø§Ø±Ø© 'under the weather'ØŸ\\n\\nA. ðŸ¥³ Ø¹Ù†Ø¯Ù…Ø§ ØªØ±Ù‚Øµ Ø¨Ø³Ø¹Ø§Ø¯Ø© ÙÙŠ Ø­ÙÙ„Ø©.\\nB. ðŸ˜´ Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ù…Ø³ØªÙ„Ù‚ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø±ÙŠØ± ÙˆØªØ´Ø¹Ø± Ø¨Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ø±ÙˆØ¯Ø© ÙˆØ§Ù„ØªÙˆØ¹Ùƒ.\\nC. ðŸ‹ï¸â€â™€ï¸ Ø¹Ù†Ø¯Ù…Ø§ ØªØ±ÙØ¹ Ø§Ù„Ø£Ø«Ù‚Ø§Ù„ Ø¨Ù†Ø´Ø§Ø· ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©.\",\n        \"answer\": \"B\"\n      }\n    }\n  },\n  \"dialogue\": [\n    {\n      \"role\": \"A\",\n      \"en\": \"Hey, you look a bit down. Are you okay?\",\n      \"translations\": {\n        \"ko\": \"ì €ê¸°, ì¢€ ê¸°ë¶„ì´ ì•ˆ ì¢‹ì•„ ë³´ì´ëŠ”ë°. ê´œì°®ì•„ìš”?\",\n        \"ja\": \"ã­ãˆã€ãªã‚“ã ã‹å…ƒæ°—ãŒãªã„ã¿ãŸã„ã ã‘ã©å¤§ä¸ˆå¤«ï¼Ÿ\",\n        \"es\": \"Oye, te ves un poco desanimado. Â¿EstÃ¡s bien?\",\n        \"fr\": \"HÃ©, tu as l'air un peu dÃ©primÃ©. Ã‡a va ?\",\n        \"de\": \"Hey, du siehst ein bisschen niedergeschlagen aus. Alles okay?\",\n        \"ru\": \"Ð­Ð¹, Ñ‚Ñ‹ Ð²Ñ‹Ð³Ð»ÑÐ´Ð¸ÑˆÑŒ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¼. Ð¢Ñ‹ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ?\",\n        \"zh\": \"å˜¿ï¼Œä½ çœ‹èµ·æ¥æœ‰ç‚¹æ²®ä¸§ã€‚ä½ è¿˜å¥½å—ï¼Ÿ\",\n        \"ar\": \"Ù…Ù‡Ù„Ø§Ù‹ØŒ ØªØ¨Ø¯Ùˆ Ù…Ø­Ø¨Ø·Ø§Ù‹ Ù‚Ù„ÙŠÙ„Ø§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ø¨Ø®ÙŠØ±ØŸ\"\n      }\n    },\n    {\n      \"role\": \"B\",\n      \"en\": \"I'm feeling a bit under the weather today, so I think I'll just head home early.\",\n      \"translations\": {\n        \"ko\": \"ì˜¤ëŠ˜ ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ì„œ, ì¼ì° ì§‘ì— ê°€ë ¤ê³ ìš”.\",\n        \"ja\": \"ä»Šæ—¥ã¯ã¡ã‚‡ã£ã¨ä½“èª¿ãŒæ‚ªã„ã®ã§ã€æ—©ã‚ã«å¸°ã‚ã†ã¨æ€ã„ã¾ã™ã€‚\",\n        \"es\": \"Hoy me siento un poco mal, asÃ­ que creo que me irÃ© a casa temprano.\",\n        \"fr\": \"Je ne me sens pas trÃ¨s bien aujourd'hui, donc je pense que je vais rentrer plus tÃ´t.\",\n        \"de\": \"Ich fÃ¼hle mich heute etwas angeschlagen, deshalb werde ich wohl frÃ¼her nach Hause gehen.\",\n        \"ru\": \"Ð¯ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð½ÐµÐ²Ð°Ð¶Ð½Ð¾ ÑÐµÐ±Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð´ÑƒÐ¼Ð°ÑŽ Ð¿Ð¾Ð¹Ñ‚Ð¸ Ð´Ð¾Ð¼Ð¾Ð¹ Ð¿Ð¾Ñ€Ð°Ð½ÑŒÑˆÐµ.\",\n        \"zh\": \"æˆ‘ä»Šå¤©èº«ä½“æœ‰ç‚¹ä¸èˆ’æœï¼Œæƒ³æ—©ç‚¹å›žå®¶ã€‚\",\n        \"ar\": \"Ø£Ø´Ø¹Ø± Ø¨ØªÙˆØ¹Ùƒ Ù‚Ù„ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ØŒ Ù„Ø°Ø§ Ø³Ø£Ø¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¨ÙƒØ±Ø§Ù‹.\"\n      }\n    }\n  ],\n  \"tags\": [\"daily\", \"health\", \"lifestyle\"]\n}",
                "batching": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chainLlm",
            "typeVersion": 1.8,
            "position": [
                400,
                -144
            ],
            "id": "gemini-generator",
            "name": "Gemini Content Generator"
        },
        {
            "parameters": {
                "jsCode": "// Merge Logic: Gemini Output + Original Supabase Data\nconst rawText = $input.first().json.text;\nconst cleanJson = rawText.replace(/```json/g, \"\").replace(/`/g, \"\").trim();\n\ntry {\n  const generatedData = JSON.parse(cleanJson);\n  \n  // Using pairedItem to find the item from 'Split In Batches' node logic\n  const inputItem = $input.item;\n  \n  let originalData = null;\n  \n  if (inputItem.pairedItem) {\n      // Accessing item from Split In Batches\n      const splitItems = $items(\"Split In Batches\");\n      if (splitItems && splitItems.length > 0) {\n          originalData = splitItems[0].json;\n      }\n  }\n  \n  if (!originalData) {\n      throw new Error(\"Could not find original data to merge\");\n  }\n  \n  // Clone original\n  const mergedData = JSON.parse(JSON.stringify(originalData));\n  \n  // Target Languages for Backfill (Includes all potential langs)\n  const targetLangs = ['en', 'de', 'fr', 'ru', 'zh', 'ar'];\n\n  // 1. Merge 'meaning'\n  if (!mergedData.meaning) mergedData.meaning = {};\n  targetLangs.forEach(lang => {\n      if (generatedData.meaning && generatedData.meaning[lang]) {\n          mergedData.meaning[lang] = generatedData.meaning[lang];\n      }\n  });\n  \n  // 2. Merge 'content'\n  if (!mergedData.content) mergedData.content = {};\n  targetLangs.forEach(lang => {\n      if (generatedData.content && generatedData.content[lang]) {\n          mergedData.content[lang] = generatedData.content[lang];\n      }\n  });\n  \n  // 3. Merge 'dialogue' (Update EN and add new translations)\n  // existing dialogue: mergedData.dialogue (Array)\n  // generated dialogue: generatedData.dialogue (Array of Objs with en + translations)\n  if (mergedData.dialogue && Array.isArray(mergedData.dialogue) && \n      generatedData.dialogue && Array.isArray(generatedData.dialogue)) {\n      \n      mergedData.dialogue.forEach((turn, index) => {\n          const newTurn = generatedData.dialogue[index];\n          if (newTurn) {\n              // Update English text if present\n              if (newTurn.en) {\n                  turn.en = newTurn.en;\n              }\n\n              // Update translations\n              if (newTurn.translations) {\n                  if (!turn.translations) turn.translations = {};\n                  // Merge new languages into translations object\n                  targetLangs.forEach(lang => {\n                      if (lang === 'en') return; \n                      // Update if generated and target list includes it\n                      if (newTurn.translations[lang]) {\n                          turn.translations[lang] = newTurn.translations[lang];\n                      }\n                  });\n              }\n          }\n      });\n  }\n\n  return {\n    json: mergedData\n  };\n} catch (error) {\n  return {\n    json: {\n      error: \"JSON Parsing/Merge Failed\",\n      raw: rawText,\n      details: error.message\n    }\n  };\n}"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                640,
                -144
            ],
            "id": "parse-content-json",
            "name": "Parse Content JSON"
        },
        {
            "parameters": {
                "operation": "update",
                "schema": {
                    "__rl": true,
                    "value": "speak_mango_en",
                    "mode": "list",
                    "cachedResultName": "speak_mango_en"
                },
                "tableId": {
                    "__rl": true,
                    "value": "expressions",
                    "mode": "list",
                    "cachedResultName": "expressions"
                },
                "updateKey": "id",
                "columns": "meaning, content",
                "options": {}
            },
            "id": "supabase-update",
            "name": "Supabase Update",
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
                880,
                -144
            ],
            "credentials": {
                "supabaseApi": {
                    "id": "your-supabase-api-id",
                    "name": "Supabase account"
                }
            }
        },
        {
            "parameters": {
                "amount": 20,
                "unit": "seconds"
            },
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1,
            "position": [
                1100,
                -144
            ],
            "id": "wait-node",
            "name": "Rate Limit Wait"
        }
    ],
    "pinData": {},
    "connections": {
        "Manual Trigger": {
            "main": [
                [
                    {
                        "node": "Supabase Get All",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Supabase Get All": {
            "main": [
                [
                    {
                        "node": "Filter Processed (en missing)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Filter Processed (en missing)": {
            "main": [
                [
                    {
                        "node": "Split In Batches",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Split In Batches": {
            "main": [
                [
                    {
                        "node": "Gemini Content Generator",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Google Gemini Chat Model": {
            "ai_languageModel": [
                [
                    {
                        "node": "Gemini Content Generator",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "Gemini Content Generator": {
            "main": [
                [
                    {
                        "node": "Parse Content JSON",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Parse Content JSON": {
            "main": [
                [
                    {
                        "node": "Supabase Update",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Supabase Update": {
            "main": [
                [
                    {
                        "node": "Rate Limit Wait",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Rate Limit Wait": {
            "main": [
                [
                    {
                        "node": "Split In Batches",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "active": false,
    "settings": {
        "executionOrder": "v1"
    },
    "versionId": "backfill-v2-multilang",
    "id": "backfill-workflow-multilang",
    "tags": []
}