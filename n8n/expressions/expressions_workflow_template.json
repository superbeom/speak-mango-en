{
  "name": "Speak Mango",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * *"
            }
          ]
        }
      },
      "id": "60422a79-6610-41d5-95f5-5b6e1543592c",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [-320, -320]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [192, -144],
      "id": "fb5f59aa-5aec-4b58-8642-eaf81503ca3d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "your-gemini-api-id",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [880, 112],
      "id": "8751cdbc-34aa-4684-a9d7-13ff6dfaf626",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "your-gemini-api-id",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ï£ºÏ†ú Î™©Î°ù Ï†ïÏùò (ÎåÄÎ∂ÑÎ•ò/ÏÜåÎ∂ÑÎ•ò Ï≤¥Í≥Ñ Ï†ÅÏö©)\n    const topics = [\n      {\n        domain: \"conversation\",\n        category: \"daily\",\n        topic: \"ÎØ∏Íµ≠ ÏõêÏñ¥ÎØºÏù¥ Îß§Ïùº Ïì∞Îäî ÏÉùÌôú ÏòÅÏñ¥ ÌëúÌòÑ\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"business\",\n        topic: \"ÎπÑÏ¶àÎãàÏä§ ÎØ∏ÌåÖÏù¥ÎÇò Ïù¥Î©îÏùºÏóêÏÑú Íº≠ ÌïÑÏöîÌïú Ï†ïÏ§ëÌïú ÏòÅÏñ¥ ÌëúÌòÑ\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"travel\",\n        topic: \"Ìï¥Ïô∏ Ïó¨ÌñâÌï† Îïå Ïú†Ïö©Ìïú ÌïÑÏàò ÏòÅÏñ¥ ÌëúÌòÑ\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"shopping\",\n        topic: \"Ìï¥Ïô∏ ÏßÅÍµ¨ ÏáºÌïëÏù¥ÎÇò Îß§Ïû•ÏóêÏÑú ÏÇ¨Ïö©ÌïòÎäî ÏáºÌïë Í¥ÄÎ†® ÏòÅÏñ¥ ÌëúÌòÑ\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"emotion\",\n        topic: \"Í∏∞ÏÅ®, Ïä¨Ìîî, ÌôîÎÇ® Îì± Í∞êÏ†ïÏùÑ ÏÑ¨ÏÑ∏ÌïòÍ≤å ÌëúÌòÑÌïòÎäî ÏòÅÏñ¥ Îã®Ïñ¥\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"slang\",\n        topic: \"ÎØ∏ÎìúÎÇò ÏòÅÌôîÏóê ÏûêÏ£º ÎÇòÏò§Îäî ÏµúÏã† Ìä∏Î†åÎîîÌïú Ïä¨Îû≠\",\n      },\n    ];\n\n    // ÎûúÎç§ ÏÑ†ÌÉù\n    const selected = topics[Math.floor(Math.random() * topics.length)];\n\n    return {\n      json: {\n        domain: selected.domain,\n        category: selected.category,\n        topic: selected.topic, // AI ÌîÑÎ°¨ÌîÑÌä∏Ïö©\n      },\n    };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-160, -320],
      "id": "6eae6007-a015-40f5-a817-e38ef8534850",
      "name": "Pick Category"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: Professional English Teacher\n  Task: Suggest ONE useful English expression related to the category below.\n\n  Domain: {{ $('Pick Category').first().json.domain }}\n  Category: {{ $('Pick Category').first().json.category }}\n\n# EXCLUDED EXPRESSIONS (Do NOT generate these):\n  {{ $items(\"Get Existing Expressions\").map(item => item.json.expression).join(\", \") }}\n\n  Requirements:\n  1. The expression must be practical and widely used.\n  2. **Do NOT use any expression listed in the 'EXCLUDED EXPRESSIONS' list.**\n  3. Capitalization for 'expression':\n     - Start with an UPPERCASE letter for standalone sentences (e.g., \"Don't take it personally\", \"No cap\").\n     - Start with a lowercase letter for general phrases or idioms (e.g., \"spill the tea\", \"hit the road\").\n  4. Punctuation for 'expression': Do NOT include trailing periods (.) or commas (,). Exclamation marks (!) and question marks (?) are allowed.\n  5. For the 'meaning' field:\n     - Provide a concise definition in a casual tone (Î∞òÎßê).\n     - If there are multiple meanings, separate them with ' ¬∑ ' (middle dot).\n     - Do NOT end with a period (.).\n  6. Output MUST be a clean JSON object.\n\n  Output Format (JSON):\n  {\n    \"expression\": \"Hold your horses\",\n    \"meaning\": \"Ïû†Íπê Í∏∞Îã§Î†§ ¬∑ ÏßÑÏ†ïÌï¥\"\n  }",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [192, -320],
      "id": "08ab4ee3-f631-413e-a2a5-cc95b15f2faa",
      "name": "Gemini Expression Generator",
      "executeOnce": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: Professional English Content Creator & Polyglot Teacher.\nTask: Create a detailed study card for the following English expression in three languages: Korean (ko), Japanese (ja), and Spanish (es).\n\nExpression: {{ $('Parse Expression JSON').item.json.expression }}\nDomain: {{ $('Pick Category').first().json.domain }}\nCategory: {{ $('Pick Category').first().json.category }}\n\nRequirements:\n1. Tone: Friendly, humorous, and engaging (target audience: 20-30s), BUT **MUST use polite language (Ï°¥ÎåìÎßê/Desu-Masu form) consistently** for explanations.\n2. For the 'meaning' field in ALL languages:\n   - **Tone**: Use a casual tone (e.g., Korean: Î∞òÎßê) by default. **HOWEVER, if the English expression is formal or typically used in a polite situation (e.g., \"Could I...\", \"May I...\"), use a polite tone (Ï°¥ÎåìÎßê/Desu-Masu).**\n   - **Punctuation**: If the English expression is a question (?), the meaning MUST also end with a question mark (?) or be phrased as a question. Do NOT use trailing periods (.) for statements.\n   - If there are multiple meanings, separate them with ' ¬∑ ' (middle dot).\n3. Formatting for 'expression':\n   - **Capitalization**: **Start with an UPPERCASE letter** if the expression is a standalone sentence or interjection (e.g., \"No worries\", \"Never mind\", \"Don't take it personally\"). **Start with a lowercase letter** ONLY if it is a phrase or idiom used within a sentence (e.g., \"spill the tea\", \"hit the road\").\n   - Punctuation: Do NOT include trailing periods (.) or commas (,). Exclamation marks (!) and question marks (?) are allowed.\n4. Constraint for content:\n   - **NEVER use casual speech (Î∞òÎßê)** in the explanation, tips, dialogue, or situation description (except for the 'meaning' field).\n   - Do NOT mix polite and casual styles. Keep the tone consistent throughout.\n   - Do NOT address the reader as specific groups like \"Kids\" or \"Students\". Use a general, relatable tone suitable for young adults.\n5. Output MUST be a valid JSON object matching the schema below.\n6. 'meaning' and 'content' fields must contain keys for 'ko', 'ja', 'es'.\n7. **Dialogue & Roles (CRITICAL)**:\n   - Create a **coherent, natural conversation** between two people (A and B).\n   - Ensure natural interaction where either speaker can use the target expression in a meaningful context (not limited to a Q&A pattern).\n   - Each entry in the `dialogue` array MUST include:\n     - `\"role\"`: Value \"A\" or \"B\" to distinguish speakers.\n     - `\"en\"`: The English sentence.\n     - `\"translation\"`: The translated sentence in the target language.\n8. **Consistency**: Use the 'Example (Korean)' below as a reference for the depth, humor, and style. Apply the same quality to Japanese and Spanish.\n9. **Fixed Fields**: Include the 'domain' and 'category' exactly as provided in the input.\n10. **Quiz Logic (CRITICAL)**:\n    - The quiz must test the understanding of the English expression.\n    - **Randomly select one of the following patterns**:\n      - **Pattern 1 (Situation -> English)**: Describe a situation in [Target Language] and ask \"Which English expression fits this situation?\". -> The options (A, B, C) MUST be **English expressions**.\n        *   *Example (Target Language: ko)*: Q: \"ÏπúÍµ¨Í∞Ä \\\"Ïù¥Î≤à Ï£ºÎßêÏóê ÏòÅÌôî Î≥ºÍπåÏöî?\\\"ÎùºÍ≥† Ï†úÏïàÌñàÏùÑ Îïå, Í∏çÏ†ïÏ†ÅÏúºÎ°ú ÎèôÏùòÌïòÎäî Í∞ÄÏû• ÏûêÏó∞Ïä§Îü¨Ïö¥ ÏòÅÏñ¥ ÌëúÌòÑÏùÄ?\\n\\nA. Sounds bad\\nB. Sounds good\\nC. Sounds angry\"\n      - **Pattern 2 (Expression -> Situation)**: Show the expression and ask \"When would you use this?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"Îã§Ïùå Ï§ë 'What's up?'ÏùÑ Í∞ÄÏû• ÏûêÏó∞Ïä§ÎüΩÍ≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî ÏÉÅÌô©ÏùÄ?\\n\\nA. üí∞ ÏùÄÌñâÏóêÏÑú ÎåÄÏ∂ú ÏÉÅÎã¥ÏùÑ Î∞õÍ≥† ÏûàÎã§.\\nB. üöÄ ÌöåÏÇ¨ Ï§ëÏó≠ ÌöåÏùòÏóêÏÑú Î∞úÌëúÎ•º ÏãúÏûëÌïúÎã§.\\nC. üö∂‚Äç‚ôÄÔ∏è Í∏∏ÏùÑ Í±∑Îã§Í∞Ä ÏπúÍµ¨ÏôÄ ÎààÏù¥ ÎßàÏ£ºÏ≥§Îã§.\"\n      - **Pattern 3 (Negative Logic)**: Ask \"Which situation is **NOT** appropriate for this expression?\" in [Target Language]. -> The options (A, B, C) MUST be **situations described in [Target Language]**.\n        *   *Example (Target Language: ko)*: Q: \"Îã§Ïùå Ï§ë 'Let's touch base.'Ïùò ÏÇ¨Ïö©Ïù¥ Ï†ÅÏ†àÌïòÏßÄ ÏïäÏùÄ ÏÉÅÌô©ÏùÄ?\\n\\nA. üôã‚Äç‚ôÄÔ∏è ÌåÄÏõêÍ≥º Ï£ºÍ∞Ñ Î≥¥Í≥†ÏÑúÏóê ÎåÄÌï¥ ÏßßÍ≤å Ïù¥ÏïºÍ∏∞Ìï† Îïå.\\nB. ü•≥ ÏπúÍµ¨Îì§Í≥º Ï£ºÎßêÏóê ÎÜÄÎü¨ Í∞à Í≥ÑÌöçÏùÑ ÏÑ∏Ïö∏ Îïå.\\nC. üßë‚Äçüíª Í≥†Í∞ùÍ≥º Îã§Ïùå Îã®Í≥Ñ ÎÖºÏùòÎ•º ÏúÑÌï¥ Ïó∞ÎùΩÌï† Îïå.\"\n    - **Strict Formatting & Validation Rules**:\n      1. **These rules apply to ALL languages (ko, ja, es).**\n      2. You **MUST** provide 3 distinct options labeled A, B, and C.\n      3. You **MUST** use `\\n` (newline) to separate the question and each option.\n      4. The 'answer' field MUST be **only the uppercase letter** (e.g., \"A\", \"B\", \"C\"). **NEVER** include the full text of the answer.\n11. **Tags (MANDATORY)**: Include a `\"tags\"` field containing an array of 3 to 5 lowercase strings. These tags should be relevant keywords that help categorize the expression (e.g., \"idiom\", \"office\", \"slang\", \"travel\"). Do NOT include the '#' symbol.\n\nExample Output (Reference this style for ALL languages):\n{\n  \"expression\": \"under the weather\",\n  \"domain\": \"conversation\",\n  \"category\": \"daily\",\n  \"meaning\": {\n    \"ko\": \"Î™∏Ïù¥ Ï¢Ä Ïïà Ï¢ãÏïÑ ¬∑ Ïª®ÎîîÏÖòÏù¥ Î≥ÑÎ°úÏïº\",\n    \"ja\": \"‰ΩìË™ø„ÅåÂ∞ë„ÅóÊÇ™„ÅÑ ¬∑ Ê∞óÂàÜ„Åå„Åô„Åê„Çå„Å™„ÅÑ\",\n    \"es\": \"sentirse un poco mal ¬∑ no estar al cien\"\n  },\n  \"content\": {\n    \"ko\": {\n      \"situation\": \"üåü ÏïÑÏπ®Ïóê ÏùºÏñ¥ÎÇ¨ÎäîÎç∞ Ïô†ÏßÄ Î™®Î•¥Í≤å Î™∏Ïù¥ Ï∂ï Ï≤òÏßÄÍ≥†, Ïª®ÎîîÏÖòÏù¥ Î≥ÑÎ°úÏùº Îïå! üò± 'ÏïÑ, ÎÇò Ïò§Îäò Î≠îÍ∞Ä Ï¢Ä Î≥ÑÎ°†Îç∞... Î≥ëÎì† Î≥ëÏïÑÎ¶¨ Í∞ôÏïÑ...' Ìï† Îïå Ïì∞Îäî ÌïµÏù∏Ïã∏ ÌëúÌòÑÏù¥ÏóêÏöî! ÏßÑÏßú ÏïÑÌîà Í±¥ ÏïÑÎãåÎç∞ Í∑∏Î†áÎã§Í≥† ÏôÑÏ†Ñ Ïå©Ïå©ÌïòÏßÄÎèÑ ÏïäÏùÑ Îïå, Í∞ÄÎ≥çÍ≤å ÎÇ¥ ÏÉÅÌÉúÎ•º ÎßêÌïòÍ≥† Ïã∂ÏùÑ Îïå Ï∞∞Îñ°Í∞ôÏù¥ Ïì∏ Ïàò ÏûàÎãµÎãàÎã§! ü§í‚ú®\",\n      \"dialogue\": [\n        { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"Ï†ÄÍ∏∞, Ï¢Ä Í∏∞Î∂ÑÏù¥ Ïïà Ï¢ãÏïÑ Î≥¥Ïù¥ÎäîÎç∞. Í¥úÏ∞ÆÏïÑÏöî?\", \"role\": \"A\" },\n        { \"en\": \"I'm feeling a bit under the weather today, so I think I'll just head home early.\", \"translation\": \"Ïò§Îäò Î™∏Ïù¥ Ï¢Ä Ïïà Ï¢ãÏïÑÏÑú, ÏùºÏ∞ç ÏßëÏóê Í∞ÄÎ†§Í≥†Ïöî.\", \"role\": \"B\" }\n      ],\n      \"tip\": \"üö® **ÍøÄÌåÅ Î∞©Ï∂ú!** 'under the weather'Îäî ÏßÑÏßú Ïã¨Í∞ÅÌïòÍ≤å ÏïÑÌîå ÎïåÎ≥¥Îã§Îäî Í∞ÄÎ≥çÍ≤å 'Ïª®ÎîîÏÖòÏù¥ Ïïà Ï¢ãÎã§', 'Í∞êÍ∏∞ Í∏∞Ïö¥Ïù¥ ÏûàÎã§' Ï†ïÎèÑÏùò ÎäêÎÇåÏù¥ÏóêÏöî. üò∑ ÎßåÏïΩ ÏßÑÏßú Ïã¨ÌïòÍ≤å ÏïÑÌîÑÎã§Î©¥ 'I'm sick' ÎòêÎäî 'I have a fever'Ï≤òÎüº Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÎßêÌïòÎäî Í≤å Ï¢ãÏïÑÏöî. üòâ Í∑∏Î¶¨Í≥† Ïù¥ ÌëúÌòÑÏùÄ Î±ÉÏÇ¨ÎûåÎì§Ïù¥ Î∞∞ÏóêÏÑú ÎÇ†Ïî®Í∞Ä Ïïà Ï¢ãÏùÑ Îïå ÏïÑÌîà ÏÇ¨ÎûåÏùÑ Í∞ëÌåê ÏïÑÎûòÎ°ú Î≥¥ÎÇ¥ 'ÎÇ†Ïî® ÏïÑÎûò'Ïóê ÏûàÍ≤å ÌñàÎã§Îäî Ïú†ÎûòÍ∞Ä ÏûàÎåÄÏöî! ÏôÑÏ†Ñ Ïã†Í∏∞ÌïòÏ£†? ‚öìÔ∏èüåä\",\n      \"quiz\": {\n        \"question\": \"Îã§Ïùå Ï§ë 'under the weather'Î•º ÏÇ¨Ïö©ÌïòÍ∏∞ Í∞ÄÏû• Ï†ÅÏ†àÌïú ÏÉÅÌô©ÏùÄ?\\n\\nA. ü•≥ ÌååÌã∞ÏóêÏÑú Ïã†ÎÇòÍ≤å Ï∂§Ï∂îÍ≥† ÏûàÎã§.\\nB. üò¥ Ïπ®ÎåÄÏóêÏÑú Î∞çÍ∏∞Ï†ÅÍ±∞Î¶¨Î©∞ Î™∏Ïù¥ Ï¢Ä ÏúºÏä¨ÏúºÏä¨ÌïòÎã§.\\nC. üèãÔ∏è‚Äç‚ôÄÔ∏è Ìó¨Ïä§Ïû•ÏóêÏÑú Ïó≠Í∏∞Î•º Îì§Í≥† Ïö¥ÎèôÌïòÍ≥† ÏûàÎã§.\",\n        \"answer\": \"B\"\n      }\n    },\n    \"ja\": {\n      \"situation\": \"ÊúùËµ∑„Åç„ÅüÊôÇ„Å´„ÄÅ„Å™„Çì„Å®„Å™„Åè‰Ωì„Åå„Å†„Çã„Åè„Å¶„Äå‰ªäÊó•„ÅØ„Å™„Çì„Å†„ÅãË™øÂ≠ê„ÅåÊÇ™„ÅÑ„Å™‚Ä¶„Äç„Å®ÊÑü„Åò„ÇãÊôÇ„Å´„Å¥„Å£„Åü„Çä„ÅÆË°®Áèæ„Åß„ÅôÔºÅüò∑ Êú¨ÂΩì„Å´„Å≤„Å©„ÅÑÁóÖÊ∞ó„Åß„ÅØ„Å™„ÅÑ„Åë„Çå„Å©„ÄÅ100%ÂÖÉÊ∞ó„Åß„ÇÇ„Å™„ÅÑÊôÇ„Å´„ÄÅËá™ÂàÜ„ÅÆÁä∂ÊÖã„Çí„Ç´„Ç∏„É•„Ç¢„É´„Å´‰ºù„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ‚ú®\",\n      \"dialogue\": [\n        { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"„Å≠„Åà„ÄÅ„Å™„Çì„Å†„ÅãÂÖÉÊ∞ó„Åå„Å™„ÅÑ„Åø„Åü„ÅÑ„Å†„Åë„Å©Â§ß‰∏àÂ§´Ôºü\", \"role\": \"A\" },\n        { \"en\": \"I'm feeling a bit under the weather today.\", \"translation\": \"‰ªäÊó•„ÅØ„Å°„Çá„Å£„Å®‰ΩìË™ø„ÅåÊÇ™„Åè„Å¶„ÄÇ\", \"role\": \"B\" }\n      ],\n      \"tip\": \"üí° **Ë±ÜÁü•Ë≠ò!** „Åì„ÅÆË°®Áèæ„ÅØ„ÄÅÊòî„ÅÆËàπ‰πó„Çä„ÅåÂ§©ÂÄô„ÅåÊÇ™„Åè„Å¶‰ΩìË™ø„ÇíÂ¥©„Åó„ÅüÊôÇ„Å´„ÄÅÁî≤Êùø„ÅÆ‰∏ãÔºàUnder the deckÔºâ„Å´ÈÅøÈõ£„Åó„Åü„Åì„Å®„Åã„Çâ„ÄåUnder the weather„Äç„Å´„Å™„Å£„Åü„Å®„ÅÑ„ÅÜË™¨„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ‚öìÔ∏è Êú¨ÂΩì„Å´‰ΩìË™ø„ÅåÊÇ™„ÅÑÊôÇ„ÅØ„ÄåI'm sick„Äç„Çí‰Ωø„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ\",\n      \"quiz\": {\n        \"question\": \"„Äåunder the weather„Äç„Çí‰Ωø„ÅÜ„ÅÆ„Å´ÊúÄ„ÇÇÈÅ©„Åó„ÅüÁä∂Ê≥Å„ÅØÔºü\\n\\nA. ü•≥ „Éë„Éº„ÉÜ„Ç£„Éº„ÅßÊ•Ω„Åó„ÅèË∏ä„Å£„Å¶„ÅÑ„Çã„ÄÇ\\nB. üò¥ È¢®ÈÇ™Ê∞óÂë≥„Åß„ÄÅ„Éô„ÉÉ„Éâ„Åß‰ºë„Çì„Åß„ÅÑ„Çã„ÄÇ\\nC. üèãÔ∏è‚Äç‚ôÄÔ∏è „Ç∏„É†„ÅßÂÖÉÊ∞ó„Å´„Éà„É¨„Éº„Éã„É≥„Ç∞„Åó„Å¶„ÅÑ„Çã„ÄÇ\",\n        \"answer\": \"B\"\n      }\n    },\n    \"es\": {\n      \"situation\": \"¬°Cuando te despiertas y te sientes un poco cansado o sin energ√≠a! üò± Es una expresi√≥n muy com√∫n para decir que no te sientes al 100%, pero tampoco est√°s gravemente enfermo. ü§í‚ú®\",\n      \"dialogue\": [\n        { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"Oye, te ves un poco desanimado. ¬øEst√°s bien?\", \"role\": \"A\" },\n        { \"en\": \"I'm feeling a bit under the weather today.\", \"translation\": \"Hoy me siento un poco mal.\", \"role\": \"B\" }\n      ],\n      \"tip\": \"üö® **¬°Dato curioso!** El origen viene de los marineros. Cuando el clima era malo y se sent√≠an mal, bajaban debajo de la cubierta para estar 'bajo el clima'. üåä‚öìÔ∏è Si est√°s realmente enfermo, es mejor usar 'I'm sick'.\",\n      \"quiz\": {\n        \"question\": \"¬øEn qu√© situaci√≥n usar√≠as \\\"under the weather\\\"?\\n\\nA. ü•≥ En una fiesta bailando alegremente.\\nB. üò¥ Descansando en la cama porque te sientes un poco mal.\\nC. üèãÔ∏è‚Äç‚ôÄÔ∏è Entrenando con mucha energ√≠a en el gimnasio.\",\n        \"answer\": \"B\"\n      }\n    }\n  },\n  \"tags\": [\"daily\", \"health\", \"lifestyle\"]\n}",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [880, -80],
      "id": "cae8a80a-ddfa-4f03-932d-e2f22f442fe4",
      "name": "Gemini Content Generator"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "operation": "getAll",
        "tableId": "expressions",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "expression",
              "condition": "ilike",
              "keyValue": "=*{{ $('Parse Expression JSON').item.json.expression }}*"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [496, -64],
      "id": "9217fca3-7a94-4077-96c0-26d37e4a6a54",
      "name": "Check Duplicate",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "7588390d-2c9b-4409-9df3-6e365605d4a6",
              "leftValue": "={{ $('Check Duplicate').first().json.expression }}",
              "rightValue": 0,
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [656, -64],
      "id": "b2e22d2a-abc8-41a5-ba15-18b92004e7d3",
      "name": "If New"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "tableId": "expressions",
        "dataToSend": "autoMapInputData"
      },
      "id": "49569b5d-6f3c-4b58-941a-1154a827cfea",
      "name": "Supabase Insert",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [2128, -80],
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "  // GeminiÏùò ÏùëÎãµÏóêÏÑú JSON Î¨∏ÏûêÏó¥ Î∂ÄÎ∂ÑÎßå Ï∂îÏ∂úÌïòÏó¨ ÌååÏã±Ìï©ÎãàÎã§.\n  const rawText = $input.first().json.text;\n  // ÎßàÌÅ¨Îã§Ïö¥ ÏΩîÎìú Î∏îÎ°ù(```json ... ```) Ï†úÍ±∞\n  const cleanJson = rawText.replace(/```json/g, \"\").replace(/`/g, \"\").trim();\n\n  try {\n    return {\n      json: JSON.parse(cleanJson)\n    };\n  } catch (error) {\n    // ÌååÏã± Ïã§Ìå® Ïãú ÏóêÎü¨ Î°úÍ∑∏ Î∞òÌôò (ÎîîÎ≤ÑÍπÖÏö©)\n    return {\n      json: {\n        error: \"JSON Parsing Failed\",\n        raw: rawText\n      }\n    };\n  }"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [480, -320],
      "id": "4b391b28-8566-4560-b1df-1fbd42b680ae",
      "name": "Parse Expression JSON"
    },
    {
      "parameters": {
        "jsCode": "  // GeminiÏùò ÏùëÎãµÏóêÏÑú JSON Î¨∏ÏûêÏó¥ Î∂ÄÎ∂ÑÎßå Ï∂îÏ∂úÌïòÏó¨ ÌååÏã±Ìï©ÎãàÎã§.\n  const rawText = $input.first().json.text;\n  // ÎßàÌÅ¨Îã§Ïö¥ ÏΩîÎìú Î∏îÎ°ù(```json ... ```) Ï†úÍ±∞\n  const cleanJson = rawText.replace(/```json/g, \"\").replace(/`/g, \"\").trim();\n\n  try {\n    return {\n      json: JSON.parse(cleanJson)\n    };\n  } catch (error) {\n    // ÌååÏã± Ïã§Ìå® Ïãú ÏóêÎü¨ Î°úÍ∑∏ Î∞òÌôò (ÎîîÎ≤ÑÍπÖÏö©)\n    return {\n      json: {\n        error: \"JSON Parsing Failed\",\n        raw: rawText\n      }\n    };\n  }"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1168, -80],
      "id": "6dae234a-7f34-4704-bb66-359150049071",
      "name": "Parse Content JSON"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "speak_mango_en",
        "operation": "getAll",
        "tableId": "expressions",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "category",
              "condition": "eq",
              "keyValue": "={{ $('Pick Category').item.json.category }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [16, -320],
      "id": "6d363283-08a9-4204-bc03-9589e89a7549",
      "name": "Get Existing Expressions",
      "alwaysOutputData": false,
      "executeOnce": false,
      "retryOnFail": false,
      "notesInFlow": false,
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Generate UUID\n// Ï§ëÎ≥µÏù¥ ÏïÑÎãòÏù¥ ÌôïÏù∏Îêú ÌõÑ, Ï†ÄÏû• Í≤ΩÎ°ú Î∞è DB IDÎ°ú ÏÇ¨Ïö©Ìï† UUIDÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§.\n\n// crypto Î™®ÎìàÏù¥ Í∏ÄÎ°úÎ≤åÏóê ÏóÜÏùÑ Í≤ΩÏö∞Î•º ÎåÄÎπÑÌï¥ ÏßÅÏ†ë UUID v4 ÏÉùÏÑ± Î°úÏßÅ ÏÇ¨Ïö©\nconst uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n  const r = Math.random() * 16 | 0;\n  const v = c === 'x' ? r : (r & 0x3 | 0x8);\n  return v.toString(16);\n});\n\nreturn {\n  json: {\n    ...$input.first().json,\n    id: uuid\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1328, -80],
      "id": "5b829c88-78aa-48c5-8da8-5b259f51df6a",
      "name": "Generate ID"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Prepare TTS Requests (Groq Orpheus V1)\n// ÎåÄÌôîÎ¨∏Ïùò Ïó≠Ìï†(A, B)Ïóê Îî∞Îùº ÏïÑÏù¥ÌÖúÏùÑ Î∂ÑÎ¶¨ÌïòÍ≥† Í∞ÅÍ∞Å Î™©ÏÜåÎ¶¨Î•º Ìï†ÎãπÌï©ÎãàÎã§.\n\nconst items = $input.all();\nlet results = [];\n\nitems.forEach((item, itemIndex) => {\n    const data = item.json;\n    \n    // ko Í∏∞Î∞òÏúºÎ°ú ÎåÄÌôîÎ¨∏ Ï∂îÏ∂ú (Î™®Îì† Ïñ∏Ïñ¥Í∞Ä ÎèôÏùºÌïú en ÎåÄÌôîÎ¨∏ÏùÑ Í≥µÏú†ÌïòÎØÄÎ°ú)\n    const dialogueEntries = data.content?.ko?.dialogue || [];\n    const expressionId = data.id;\n\n    dialogueEntries.forEach((entry, lineIndex) => {\n        const rawText = entry.en || \"\";\n        const role = (entry.role || \"A\").toUpperCase();\n\n        // ÌÖçÏä§Ìä∏ Ï†ïÏ†ú\n        const cleanedText = rawText.replace(/\\n/g, \" \").replace(/\\s+/g, \" \").trim();\n        \n        // Ïó≠Ìï†Î≥Ñ Î™©ÏÜåÎ¶¨ Ìï†Îãπ\n        const voice = (role === 'B') ? 'troy' : 'hannah';\n\n        results.push({\n            json: {\n                ...data, // ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Ïú†ÏßÄ\n                tts_input: cleanedText.substring(0, 200),\n                tts_voice: voice,\n                tts_line_index: lineIndex,\n                tts_model: \"canopylabs/orpheus-v1-english\",\n                tts_format: \"wav\",\n                tts_endpoint: \"https://api.groq.com/openai/v1/audio/speech\",\n                // Storage Ï†ÄÏû•ÏùÑ ÏúÑÌïú Í≤ΩÎ°ú ÌôïÏ†ï\n                storage_path: `expressions/${expressionId}/${lineIndex}.wav`\n            },\n            pairedItem: { item: itemIndex }\n        });\n    });\n});\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1488, -80],
      "id": "ede3e623-0102-4818-b6f5-4c12a32f99ca",
      "name": "Prepare TTS Requests"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/audio/speech",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "canopylabs/orpheus-v1-english"
            },
            {
              "name": "input",
              "value": "={{ $json.tts_input }}"
            },
            {
              "name": "voice",
              "value": "={{ $json.tts_voice }}"
            },
            {
              "name": "response_format",
              "value": "wav"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [1648, -80],
      "id": "bd116d19-f0b5-4f81-8bd5-4fde96fe1838",
      "name": "Groq Orpheus TTS",
      "credentials": {
        "httpHeaderAuth": {
          "id": "your-http-header-auth-id",
          "name": "Groq Header Auth"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://<YOUR_PROJECT_REF>.supabase.co/storage/v1/object/speak-mango-en/{{ $json.storage_path }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [1808, -80],
      "id": "4ede8024-8434-41e8-9cd3-4a800e3a9705",
      "name": "Upload to Storage",
      "credentials": {
        "httpHeaderAuth": {
          "id": "your-http-header-auth-id",
          "name": "Supabase Header Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// n8n Code Node: Aggregate TTS Results\n// Î∂ÑÎ¶¨ÎêòÏóàÎçò ÎåÄÌôîÎ¨∏ ÎùºÏù∏Îì§ÏùÑ Îã§Ïãú ÌïòÎÇòÎ°ú Ìï©ÏπòÍ≥† audio_urlÏùÑ Ï£ºÏûÖÌï©ÎãàÎã§.\n\nconst items = $input.all();\nif (items.length === 0) return [];\n\n// 1. ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Î≥µÏõê (Prepare TTS Requests ÎÖ∏ÎìúÏùò Í≤∞Í≥º Ï∞∏Ï°∞)\nconst firstItem = items[0];\nconst parentItemIndex = firstItem.pairedItem.item;\nconst parentData = $items(\"Prepare TTS Requests\")[parentItemIndex].json;\n\n// ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞ Î≥µÏ†ú (deep copy)\nlet finalData = JSON.parse(JSON.stringify(parentData));\n\n// 2. Î∂àÌïÑÏöîÌïú ÏûÑÏãú ÌïÑÎìú ÏùºÍ¥Ñ Ï†úÍ±∞ (tts_ Î°ú ÏãúÏûëÌïòÎäî Î™®Îì† ÌïÑÎìú)\nObject.keys(finalData).forEach((key) => {\n  if (key.startsWith(\"tts_\") || key === \"storage_path\") {\n    delete finalData[key];\n  }\n});\n\n// 3. Ïò§ÎîîÏò§ URL Ï£ºÏûÖ\nitems.forEach((item) => {\n  const pIdx = item.pairedItem.item;\n  const originalReq = $items(\"Prepare TTS Requests\")[pIdx].json;\n\n  const idx = originalReq.tts_line_index;\n  // Upload to Storage Í≤∞Í≥º(Key)ÏóêÏÑú Í≤ΩÎ°ú Ï∂îÏ∂ú\n  let path = item.json.Key || originalReq.storage_path;\n\n  // Î≤ÑÌÇ∑ Î™ÖÏπ≠(speak-mango-en/)Ïù¥ Ìè¨Ìï®ÎêòÏñ¥ ÏûàÎã§Î©¥ Ï†úÍ±∞ÌïòÏó¨ Í≤ΩÎ°ú Ï†ïÍ∑úÌôî\n  if (path.startsWith(\"speak-mango-en/\")) {\n    path = path.replace(\"speak-mango-en/\", \"\");\n  }\n\n  // Î™®Îì† Ïñ∏Ïñ¥Ïùò ÎåÄÌôîÎ¨∏Ïóê ÎèôÏùºÌïú audio_url Ï£ºÏûÖ\n  [\"ko\", \"ja\", \"es\"].forEach((lang) => {\n    if (\n      finalData.content &&\n      finalData.content[lang] &&\n      finalData.content[lang].dialogue &&\n      finalData.content[lang].dialogue[idx]\n    ) {\n      finalData.content[lang].dialogue[idx].audio_url = path;\n    }\n  });\n});\n\nreturn [{ json: finalData }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1968, -80],
      "id": "8aca45c9-383b-4fbd-8adb-033e9aaa5f54",
      "name": "Aggregate TTS Results"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Pick Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Expression Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Content Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pick Category": {
      "main": [
        [
          {
            "node": "Get Existing Expressions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Expression Generator": {
      "main": [
        [
          {
            "node": "Parse Expression JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Content Generator": {
      "main": [
        [
          {
            "node": "Parse Content JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate": {
      "main": [
        [
          {
            "node": "If New",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If New": {
      "main": [
        [
          {
            "node": "Gemini Content Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Expression JSON": {
      "main": [
        [
          {
            "node": "Check Duplicate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Content JSON": {
      "main": [
        [
          {
            "node": "Generate ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Existing Expressions": {
      "main": [
        [
          {
            "node": "Gemini Expression Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate ID": {
      "main": [
        [
          {
            "node": "Prepare TTS Requests",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare TTS Requests": {
      "main": [
        [
          {
            "node": "Groq Orpheus TTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Groq Orpheus TTS": {
      "main": [
        [
          {
            "node": "Upload to Storage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload to Storage": {
      "main": [
        [
          {
            "node": "Aggregate TTS Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate TTS Results": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "your-version-id",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "your-instance-id"
  },
  "id": "your-workflow-id",
  "tags": []
}
