# Analytics 구현 가이드

> **작성일**: 2026-01-14  
> **목적**: Speak Mango 서비스에 사용자 행동 분석 기능을 추가하여 데이터 기반 의사결정 지원

## 1. 개요

### 왜 Analytics가 필요한가?

Analytics를 통해 다음과 같은 질문에 답할 수 있습니다:

- 📊 **사용자 행동**: 사용자들이 어떤 표현을 가장 많이 보는가?
- 🎯 **학습 패턴**: 오디오 재생 기능을 얼마나 활용하는가?
- 🔍 **콘텐츠 성과**: 어떤 카테고리가 가장 인기 있는가?
- 💰 **수익화 준비**: 향후 유료 기능 전환율을 측정할 수 있는가?

### 핵심 목표

1. **사용자 참여도(Engagement) 측정**: 페이지 뷰, 체류 시간, 상호작용 빈도
2. **학습 효과 분석**: 학습 모드 사용률, 오디오 재생 패턴
3. **콘텐츠 최적화**: 인기 표현/카테고리 파악 및 콘텐츠 전략 수립
4. **전환율 추적**: 향후 유료 기능 도입 시 전환 퍼널 분석

## 2. Analytics Provider 선택

### 옵션 비교

| Provider               | 장점                                                             | 단점                                         | 비용        | 추천도     |
| ---------------------- | ---------------------------------------------------------------- | -------------------------------------------- | ----------- | ---------- |
| **Google Analytics 4** | • 무료<br>• 강력한 분석 기능<br>• Google Ads 연동<br>• 업계 표준 | • 설정이 다소 복잡<br>• 프라이버시 우려 가능 | 무료        | ⭐⭐⭐⭐⭐ |
| **Vercel Analytics**   | • Next.js 최적화<br>• 프라이버시 중심<br>• 설정 간단             | • 유료<br>• 기능 제한적                      | $10/월      | ⭐⭐⭐     |
| **Mixpanel**           | • 이벤트 중심 분석<br>• 사용자 여정 추적                         | • 무료 티어 제한<br>• 학습 곡선              | 제한적 무료 | ⭐⭐⭐⭐   |

### 최종 추천: Google Analytics 4 (GA4)

**선택 이유:**

- ✅ 완전 무료이면서 강력한 분석 기능 제공
- ✅ 향후 Google Ads, Google Search Console 연동 가능
- ✅ 업계 표준으로 레퍼런스와 커뮤니티 지원 풍부
- ✅ BigQuery 연동으로 고급 분석 가능 (필요 시)

## 3. 추적할 핵심 지표

### 3.1 참여도 지표 (Engagement Metrics)

| 지표               | 설명                      | 활용 방안             |
| ------------------ | ------------------------- | --------------------- |
| **페이지 뷰**      | 전체 페이지 조회수        | 트래픽 추세 파악      |
| **표현 조회수**    | 상세 페이지 조회 횟수     | 인기 콘텐츠 식별      |
| **오디오 재생**    | 원어민 대화 재생 횟수     | 학습 기능 활용도 측정 |
| **학습 모드 사용** | 블라인드/해석 블러 사용률 | 학습 기능 효과성 검증 |

### 3.2 사용자 여정 (User Journey)

| 지표                 | 설명                    | 활용 방안               |
| -------------------- | ----------------------- | ----------------------- |
| **검색 사용**        | 검색 기능 사용 빈도     | 검색 UX 개선            |
| **필터 사용**        | 카테고리/태그 필터 패턴 | 필터 UI 최적화          |
| **추천 클릭**        | 관련 표현 클릭률        | 추천 알고리즘 개선      |
| **공유 횟수** (향후) | 표현 공유 버튼 클릭     | 바이럴 마케팅 효과 측정 |

### 3.3 콘텐츠 성과 (Content Performance)

| 지표              | 설명                  | 활용 방안        |
| ----------------- | --------------------- | ---------------- |
| **인기 표현**     | 가장 많이 조회된 표현 | 유사 콘텐츠 생성 |
| **인기 카테고리** | 카테고리별 조회수     | 콘텐츠 전략 수립 |
| **인기 태그**     | 태그별 검색/클릭      | 태그 체계 최적화 |

### 3.4 전환 지표 (향후 수익화용)

| 지표               | 설명                   | 활용 방안      |
| ------------------ | ---------------------- | -------------- |
| **유료 기능 노출** | Feature Gate 모달 노출 | 전환 퍼널 분석 |
| **결제 의도**      | 결제 페이지 진입       | 전환율 최적화  |

## 4. 이벤트 설계 (Event Taxonomy)

### 4.1 네이밍 규칙

- **형식**: `{객체}_{동작}` (예: `expression_view`, `audio_play`)
- **케이스**: `snake_case` 사용
- **일관성**: 브라우저 DOM 이벤트 관례 준수 (`click`, `play` 등)

### 4.2 핵심 이벤트 목록

#### 기본 이벤트

| 이벤트명           | 설명           | 파라미터                            |
| ------------------ | -------------- | ----------------------------------- |
| `page_view`        | 페이지 조회    | `page_path`, `page_title`, `lang`   |
| `expression_view`  | 표현 상세 조회 | `expression_id`, `category`, `lang` |
| `expression_click` | 표현 카드 클릭 | `expression_id`, `source`           |

#### 학습 기능 이벤트

| 이벤트명               | 설명             | 파라미터                                    |
| ---------------------- | ---------------- | ------------------------------------------- |
| `audio_play`           | 오디오 재생 시작 | `expression_id`, `audio_index`, `play_type` |
| `audio_complete`       | 오디오 재생 완료 | `expression_id`, `audio_index`              |
| `learning_mode_toggle` | 학습 모드 전환   | `mode`, `action` (enable/disable)           |

#### 탐색 이벤트

| 이벤트명        | 설명           | 파라미터                                 |
| --------------- | -------------- | ---------------------------------------- |
| `filter_apply`  | 필터 적용      | `filter_type`, `filter_value`            |
| `search`        | 검색 실행      | `search_term`, `results_count`           |
| `tag_click`     | 태그 클릭      | `tag_name`, `source`                     |
| `related_click` | 관련 표현 클릭 | `from_expression_id`, `to_expression_id` |

#### 공유 이벤트 (향후 구현)

| 이벤트명         | 설명           | 파라미터                                          |
| ---------------- | -------------- | ------------------------------------------------- |
| `share_click`    | 공유 버튼 클릭 | `expression_id`, `share_method`, `share_platform` |
| `share_complete` | 공유 완료      | `expression_id`, `share_platform`                 |

### 4.3 이벤트 파라미터 상세

**공통 파라미터:**

- `lang`: 현재 언어 (ko, en, ja 등)
- `user_id`: 사용자 ID (로그인 후, 익명은 GA4 자동 생성)

**표현 관련:**

- `expression_id`: 표현 고유 ID (UUID)
- `expression_text`: 표현 텍스트 (예: "break a leg")
- `category`: 카테고리 (daily, business 등)

**오디오 관련:**

- `audio_index`: 대화 순서 (0, 1, 2...)
- `play_type`: 재생 방식 (`individual` | `sequential`)

**필터/검색 관련:**

- `filter_type`: 필터 종류 (`category` | `tag` | `search`)
- `filter_value`: 필터 값
- `search_term`: 검색어
- `results_count`: 검색 결과 개수

**공유 관련 (향후):**

- `share_method`: 공유 방식 (`native` | `button` | `copy_link`)
- `share_platform`: 공유 플랫폼 (`twitter` | `facebook` | `kakaotalk` | `clipboard`)
- `utm_source`: 공유 출처 추적용 UTM 파라미터

## 5. 구현 계획

### 5.1 Phase 1: 기본 설정

**작업 내용:**

1. GA4 계정 생성 및 측정 ID 발급
2. `lib/analytics.ts` 유틸리티 함수 작성
3. `layout.tsx`에 GA4 스크립트 추가
4. 환경 변수 설정 (`.env.local`)

**산출물:**

- GA4 측정 ID: `G-XXXXXXXXXX`
- Analytics 초기화 코드

### 5.2 Phase 2: 페이지 뷰 추적

**작업 내용:**

1. `AnalyticsProvider` 컴포넌트 생성
2. 라우트 변경 감지 및 자동 페이지 뷰 전송
3. 다국어 정보 포함

**검증:**

- GA4 실시간 보고서에서 페이지 뷰 확인

### 5.3 Phase 3: 이벤트 추적

**작업 내용:**

1. **표현 관련 이벤트**

   - ✅ `ExpressionCard.tsx`: 클릭 추적
   - ✅ `ExpressionViewTracker.tsx`: 조회 추적 (서버/클라이언트 분리)

2. **오디오 관련 이벤트**

   - ✅ `DialogueAudioButton.tsx`: 재생 추적
   - ✅ `DialogueAudioButton.tsx`: 재생 완료 추적

3. **학습 모드 이벤트**

   - ✅ `DialogueSection.tsx`: Blind Listening 모드 전환 추적
   - ✅ `DialogueSection.tsx`: Translation Blur 모드 전환 추적

4. **탐색 이벤트**

   - ✅ `FilterBar.tsx`: 카테고리 필터 추적
   - ✅ `SearchBar.tsx`: 검색 실행 추적
   - ✅ `Tag.tsx`: 태그 클릭 추적 (source: card/detail/filter 구분)
   - ✅ `RelatedExpressions.tsx`: 관련 표현 클릭 추적

5. **공유 이벤트 (향후 구현)**
   - ⏳ `ShareButton.tsx`: 공유 버튼 클릭 및 플랫폼 선택 추적
   - ⏳ Web Share API 사용 여부 추적

**검증:**

- ✅ 개발 환경에서 콘솔 로그 확인
- ✅ 모든 이벤트 파라미터 정확성 검증
- ⏳ GA4 DebugView에서 각 이벤트 확인 (프로덕션 배포 후)

### 5.4 Phase 4: 대시보드 구축

**작업 내용:**

1. GA4 맞춤 보고서 생성
2. 주요 지표 대시보드 설정
3. 알림 설정 (이상 트래픽 감지)

**대시보드 구성:**

- 일일 활성 사용자 (DAU)
- 인기 표현 Top 10
- 카테고리별 조회수
- 오디오 재생률
- 학습 모드 사용률

### 5.5 Phase 5: 문서화 및 테스트

**작업 내용:**

1. 이벤트 목록 문서화
2. 팀원 교육 자료 작성
3. 프로덕션 배포 전 최종 검증

## 6. 개인정보보호 고려사항

### 6.1 GDPR/개인정보보호법 준수

**현재 상태:**

- ✅ 익명 분석만 수행 (로그인 전)
- ✅ 개인 식별 정보 미수집
- ⚠️ 쿠키 사용 (GA4 기본)

**필요 조치:**

1. **쿠키 동의 (Cookie Consent)**

   - 한국/EU 사용자를 위한 간소화된 동의 방식
   - 향후 구현 예정 (Phase 6 수익화 단계)

2. **IP 익명화**

   - GA4 설정에서 활성화 (기본 제공)

3. **데이터 보관 기간**
   - 14개월 설정 (GA4 권장)

### 6.2 향후 Auth 도입 시

**추가 필요 사항:**

- 개인정보처리방침 업데이트
- 사용자 동의 절차 강화
- 데이터 삭제 요청 처리 프로세스

## 7. 예상 일정

| Phase    | 작업 내용        | 소요 시간 | 담당   |
| -------- | ---------------- | --------- | ------ |
| 1        | 기본 설정        | 1일       | Dev    |
| 2        | 페이지 뷰 추적   | 0.5일     | Dev    |
| 3        | 이벤트 추적      | 2일       | Dev    |
| 4        | 대시보드 구축    | 1일       | Dev/PM |
| 5        | 문서화 및 테스트 | 0.5일     | Dev    |
| **총계** |                  | **5일**   |        |

## 8. 성공 지표 (Success Metrics)

### 구현 완료 기준

- ✅ 모든 핵심 이벤트(10개 + 향후 공유 2개)가 정상 추적됨
- ✅ GA4 실시간 보고서에서 데이터 확인 가능
- ✅ 맞춤 대시보드 구축 완료
- ✅ 문서화 완료 (이벤트 목록, 설정 가이드)

### 1개월 후 검토 항목

- 📊 DAU(일일 활성 사용자) 추세
- 🎯 오디오 재생률 (목표: 30% 이상)
- 📈 학습 모드 사용률 (목표: 20% 이상)
- 🔍 검색 사용률 (목표: 15% 이상)

## 9. 참고 자료

### GA4 공식 문서

- [GA4 시작 가이드](https://support.google.com/analytics/answer/9304153)
- [이벤트 측정](https://developers.google.com/analytics/devguides/collection/ga4/events)
- [Next.js 통합](https://nextjs.org/docs/app/building-your-application/optimizing/analytics)

### 내부 문서

- `docs/project_context.md`: 프로젝트 아키텍처
- `docs/git/convention.md`: 커밋 메시지 규칙
- `docs/product/features_list.md`: 구현된 기능 목록

## 10. FAQ

**Q. Analytics 추가로 성능에 영향이 있나요?**

- A. GA4 스크립트는 비동기로 로드되며 (`strategy="afterInteractive"`), 사용자 경험에 미치는 영향은 미미합니다.

**Q. 개발 환경에서도 이벤트가 전송되나요?**

- A. 환경 변수로 제어할 수 있습니다. 프로덕션에서만 활성화하거나, 개발 환경에서는 콘솔 로그만 출력하도록 설정 가능합니다.

**Q. 사용자 개인정보는 안전한가요?**

- A. 현재는 익명 분석만 수행하며, IP 익명화가 적용됩니다. 향후 로그인 기능 추가 시 개인정보처리방침을 업데이트할 예정입니다.

**Q. 비용은 얼마나 드나요?**

- A. GA4는 완전 무료입니다. 월 1천만 이벤트까지 무료로 사용 가능하며, 현재 규모에서는 충분합니다.

---

**작성자**: AI Agent  
**최종 수정**: 2026-01-14  
**버전**: 1.0
