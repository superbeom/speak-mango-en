{
  "name": "Daily English",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * *"
            }
          ]
        }
      },
      "id": "60422a79-6610-41d5-95f5-5b6e1543592c",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [-320, -320]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [0, -144],
      "id": "fb5f59aa-5aec-4b58-8642-eaf81503ca3d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "your-gemini-api-id",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [656, 32],
      "id": "8751cdbc-34aa-4684-a9d7-13ff6dfaf626",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "your-gemini-api-id",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ì£¼ì œ ëª©ë¡ ì •ì˜ (ëŒ€ë¶„ë¥˜/ì†Œë¶„ë¥˜ ì²´ê³„ ì ìš©)\n    const topics = [\n      {\n        domain: \"conversation\",\n        category: \"daily\",\n        topic: \"ë¯¸êµ­ ì›ì–´ë¯¼ì´ ë§¤ì¼ ì“°ëŠ” ìƒí™œ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"business\",\n        topic: \"ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ…ì´ë‚˜ ì´ë©”ì¼ì—ì„œ ê¼­ í•„ìš”í•œ ì •ì¤‘í•œ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"travel\",\n        topic: \"í•´ì™¸ ì—¬í–‰í•  ë•Œ ìœ ìš©í•œ í•„ìˆ˜ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"shopping\",\n        topic: \"í•´ì™¸ ì§êµ¬ ì‡¼í•‘ì´ë‚˜ ë§¤ì¥ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‡¼í•‘ ê´€ë ¨ ì˜ì–´ í‘œí˜„\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"emotion\",\n        topic: \"ê¸°ì¨, ìŠ¬í””, í™”ë‚¨ ë“± ê°ì •ì„ ì„¬ì„¸í•˜ê²Œ í‘œí˜„í•˜ëŠ” ì˜ì–´ ë‹¨ì–´\",\n      },\n      {\n        domain: \"conversation\",\n        category: \"slang\",\n        topic: \"ë¯¸ë“œë‚˜ ì˜í™”ì— ìì£¼ ë‚˜ì˜¤ëŠ” ìµœì‹  íŠ¸ë Œë””í•œ ìŠ¬ë­\",\n      },\n    ];\n\n    // ëœë¤ ì„ íƒ\n    const selected = topics[Math.floor(Math.random() * topics.length)];\n\n    return {\n      json: {\n        domain: selected.domain,\n        category: selected.category,\n        topic: selected.topic, // AI í”„ë¡¬í”„íŠ¸ìš©\n      },\n    };"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-160, -320],
      "id": "6eae6007-a015-40f5-a817-e38ef8534850",
      "name": "Pick Category"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: Professional English Teacher\n  Task: Suggest ONE useful English expression related to the category below.\n\n  Domain: {{ $('Pick Category').item.json.domain }}\n  Category: {{ $('Pick Category').item.json.category }}\n\n  Requirements:\n  1. The expression must be practical and widely used.\n  2. Output MUST be a clean JSON object.\n\n  Output Format (JSON):\n  {\n    \"expression\": \"Hold your horses\",\n    \"meaning\": \"ì ê¹ ê¸°ë‹¤ë¦¬ì„¸ìš” / ì§„ì •í•˜ì„¸ìš”\"\n  }",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [0, -320],
      "id": "08ab4ee3-f631-413e-a2a5-cc95b15f2faa",
      "name": "Gemini Expression Generator"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Role: Professional English Content Creator & Polyglot Teacher.\n  Task: Create a detailed study card for the following English expression in three languages: Korean (ko), Japanese (ja), and Spanish (es).\n\n  Expression: {{ $('Parse Expression JSON').item.json.expression }}\n  Domain: {{ $('Pick Category').item.json.domain }}\n  Category: {{ $('Pick Category').item.json.category }}\n\n  Requirements:\n  1. Tone: Friendly, humorous, and engaging (target audience: 20-30s), BUT **MUST use polite language (ì¡´ëŒ“ë§/Desu-Masu form) consistently**.\n  2. Constraint:\n     - **NEVER use casual speech (ë°˜ë§)** in the explanation, tips, or situation description.\n     - Do NOT mix polite and casual styles. Keep the tone consistent throughout.\n     - Do NOT address the reader as specific groups like \"Kids\" or \"Students\". Use a general, relatable tone suitable for young adults.\n  3. Output MUST be a valid JSON object matching the schema below.\n  4. 'meaning' and 'content' fields must contain keys for 'ko', 'ja', 'es'.\n  5. In the dialogue section, use the key 'translation' for the translated sentence.\n  6. **Consistency**: Use the 'Example (Korean)' below as a reference for the depth, humor, and style. Apply the same quality to Japanese and Spanish.\n  7. **Fixed Fields**: Include the 'domain' and 'category' exactly as provided in the input.\n\n  Example Output (Reference this style for ALL languages):\n  {\n    \"expression\": \"under the weather\",\n    \"domain\": \"conversation\",\n    \"category\": \"daily\",\n    \"meaning\": {\n      \"ko\": \"ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„\",\n      \"ja\": \"ä½“èª¿ãŒå°‘ã—æ‚ªã„\",\n      \"es\": \"sentirse un poco mal\"\n    },\n    \"content\": {\n      \"ko\": {\n        \"situation\": \"ğŸŒŸ ì•„ì¹¨ì— ì¼ì–´ë‚¬ëŠ”ë° ì™ ì§€ ëª¨ë¥´ê²Œ ëª¸ì´ ì¶• ì²˜ì§€ê³ , ì»¨ë””ì…˜ì´ ë³„ë¡œì¼ ë•Œ! ğŸ˜± 'ì•„, ë‚˜ ì˜¤ëŠ˜ ë­”ê°€ ì¢€ ë³„ë¡ ë°... ë³‘ë“  ë³‘ì•„ë¦¬ ê°™ì•„...' í•  ë•Œ ì“°ëŠ” í•µì¸ì‹¸ í‘œí˜„ì´ì—ìš”! ì§„ì§œ ì•„í”ˆ ê±´ ì•„ë‹Œë° ê·¸ë ‡ë‹¤ê³  ì™„ì „ ìŒ©ìŒ©í•˜ì§€ë„ ì•Šì„ ë•Œ, ê°€ë³ê²Œ ë‚´ ìƒíƒœë¥¼ ë§í•˜ê³  ì‹¶ì„ ë•Œ ì°°ë–¡ê°™ì´ ì“¸ ìˆ˜ ìˆë‹µë‹ˆë‹¤! ğŸ¤’âœ¨\",\n        \"dialogue\": [\n          { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"ì €ê¸°, ì¢€ ê¸°ë¶„ì´ ì•ˆ ì¢‹ì•„ ë³´ì´ëŠ”ë°. ê´œì°®ì•„ìš”?\" },\n          { \"en\": \"I'm feeling a bit under the weather today, so I think I'll just head home early.\", \"translation\": \"ì˜¤ëŠ˜ ëª¸ì´ ì¢€ ì•ˆ ì¢‹ì•„ì„œ, ì¼ì° ì§‘ì— ê°€ë ¤ê³ ìš”.\" }\n        ],\n        \"tip\": \"ğŸš¨ **ê¿€íŒ ë°©ì¶œ!** 'under the weather'ëŠ” ì§„ì§œ ì‹¬ê°í•˜ê²Œ ì•„í”Œ ë•Œë³´ë‹¤ëŠ” ê°€ë³ê²Œ 'ì»¨ë””ì…˜ì´ ì•ˆ ì¢‹ë‹¤', 'ê°ê¸° ê¸°ìš´ì´ ìˆë‹¤' ì •ë„ì˜ ëŠë‚Œì´ì—ìš”. ğŸ˜· ë§Œì•½ ì§„ì§œ ì‹¬í•˜ê²Œ ì•„í”„ë‹¤ë©´ 'I'm sick' ë˜ëŠ” 'I have a fever'ì²˜ëŸ¼ êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ëŠ” ê²Œ ì¢‹ì•„ìš”. ğŸ˜‰ ê·¸ë¦¬ê³  ì´ í‘œí˜„ì€ ë±ƒì‚¬ëŒë“¤ì´ ë°°ì—ì„œ ë‚ ì”¨ê°€ ì•ˆ ì¢‹ì„ ë•Œ ì•„í”ˆ ì‚¬ëŒì„ ê°‘íŒ ì•„ë˜ë¡œ ë³´ë‚´ 'ë‚ ì”¨ ì•„ë˜'ì— ìˆê²Œ í–ˆë‹¤ëŠ” ìœ ë˜ê°€ ìˆëŒ€ìš”! ì™„ì „ ì‹ ê¸°í•˜ì£ ? âš“ï¸ğŸŒŠ\",\n        \"quiz\": {\n          \"question\": \"ë‹¤ìŒ ì¤‘ 'I'm feeling a bit under the weather.'ì™€ ê°€ì¥ ë¹„ìŠ·í•œ ìƒí™©ì€?\\n\\nA. ğŸ¥³ íŒŒí‹°ì—ì„œ ì‹ ë‚˜ê²Œ ì¶¤ì¶”ê³  ìˆë‹¤.\\nB. ğŸ˜´ ì¹¨ëŒ€ì—ì„œ ë°ê¸°ì ê±°ë¦¬ë©° ëª¸ì´ ì¢€ ìœ¼ìŠ¬ìœ¼ìŠ¬í•˜ë‹¤.\\nC. ğŸ‹ï¸â€â™€ï¸ í—¬ìŠ¤ì¥ì—ì„œ ì—­ê¸°ë¥¼ ë“¤ê³  ìš´ë™í•˜ê³  ìˆë‹¤.\",\n          \"answer\": \"B\"\n        }\n      },\n      \"ja\": {\n        \"situation\": \"æœèµ·ããŸæ™‚ã«ã€ãªã‚“ã¨ãªãä½“ãŒã ã‚‹ãã¦ã€Œä»Šæ—¥ã¯ãªã‚“ã ã‹èª¿å­ãŒæ‚ªã„ãªâ€¦ã€ã¨æ„Ÿã˜ã‚‹æ™‚ã«ã´ã£ãŸã‚Šã®è¡¨ç¾ã§ã™ï¼ğŸ˜· æœ¬å½“ã«ã²ã©ã„ç—…æ°—ã§ã¯ãªã„ã‘ã‚Œã©ã€100%å…ƒæ°—ã§ã‚‚ãªã„æ™‚ã«ã€è‡ªåˆ†ã®çŠ¶æ…‹ã‚’ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ä¼ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚âœ¨\",\n        \"dialogue\": [\n          { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"ã­ãˆã€ãªã‚“ã ã‹å…ƒæ°—ãŒãªã„ã¿ãŸã„ã ã‘ã©å¤§ä¸ˆå¤«ï¼Ÿ\" },\n          { \"en\": \"I'm feeling a bit under the weather today.\", \"translation\": \"ä»Šæ—¥ã¯ã¡ã‚‡ã£ã¨ä½“èª¿ãŒæ‚ªãã¦ã€‚\" }\n        ],\n        \"tip\": \"ğŸ’¡ **è±†çŸ¥è­˜!** ã“ã®è¡¨ç¾ã¯ã€æ˜”ã®èˆ¹ä¹—ã‚ŠãŒå¤©å€™ãŒæ‚ªãã¦ä½“èª¿ã‚’å´©ã—ãŸæ™‚ã«ã€ç”²æ¿ã®ä¸‹ï¼ˆUnder the deckï¼‰ã«é¿é›£ã—ãŸã“ã¨ã‹ã‚‰ã€ŒUnder the weatherã€ã«ãªã£ãŸã¨ã„ã†èª¬ãŒã‚ã‚Šã¾ã™ã€‚âš“ï¸ æœ¬å½“ã«ä½“èª¿ãŒæ‚ªã„æ™‚ã¯ã€ŒI'm sickã€ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ï¼\",\n        \"quiz\": { \"question\": \"ä½“èª¿ãŒå°‘ã—æ‚ªã„æ™‚ã«ä½¿ã†è¡¨ç¾ã¯ï¼Ÿ\", \"answer\": \"under the weather\" }\n      },\n      \"es\": {\n        \"situation\": \"Â¡Cuando te despiertas y te sientes un poco cansado o sin energÃ­a! ğŸ˜± Es una expresiÃ³n muy comÃºn para decir que no te sientes al 100%, pero tampoco estÃ¡s gravemente enfermo. ğŸ¤’âœ¨\",\n        \"dialogue\": [\n          { \"en\": \"Hey, you look a bit down. Are you okay?\", \"translation\": \"Oye, te ves un poco desanimado. Â¿EstÃ¡s bien?\" },\n          { \"en\": \"I'm feeling a bit under the weather today.\", \"translation\": \"Hoy me siento un poco mal.\" }\n        ],\n        \"tip\": \"ğŸš¨ **Â¡Dato curioso!** El origen viene de los marineros. Cuando el clima era malo y se sentÃ­an mal, bajaban debajo de la cubierta para estar 'bajo el clima'. ğŸŒŠâš“ï¸ Si estÃ¡s realmente enfermo, es mejor usar 'I'm sick'.\",\n        \"quiz\": { \"question\": \"Â¿QuÃ© dices cuando no te sientes bien pero no es grave?\", \"answer\": \"under the weather\" }\n      }\n    },\n    \"tags\": [\"daily\", \"health\", \"lifestyle\"]\n  }",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [656, -160],
      "id": "cae8a80a-ddfa-4f03-932d-e2f22f442fe4",
      "name": "Gemini Content Generator"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "daily_english",
        "operation": "getAll",
        "tableId": "expressions",
        "returnAll": true,
        "filters": {
          "conditions": [
            {
              "keyName": "expression",
              "condition": "eq",
              "keyValue": "={{ $('Parse Expression JSON').item.json.expression }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [288, -144],
      "id": "9217fca3-7a94-4077-96c0-26d37e4a6a54",
      "name": "Check Duplicate",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "7588390d-2c9b-4409-9df3-6e365605d4a6",
              "leftValue": "={{ $('Check Duplicate').first().json.expression }}",
              "rightValue": 0,
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [448, -144],
      "id": "b2e22d2a-abc8-41a5-ba15-18b92004e7d3",
      "name": "If New"
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "schema": "daily_english",
        "tableId": "expressions",
        "dataToSend": "autoMapInputData"
      },
      "id": "49569b5d-6f3c-4b58-941a-1154a827cfea",
      "name": "Supabase Insert",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1120, -160],
      "credentials": {
        "supabaseApi": {
          "id": "your-supabase-api-id",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "  // Geminiì˜ ì‘ë‹µì—ì„œ JSON ë¬¸ìì—´ ë¶€ë¶„ë§Œ ì¶”ì¶œí•˜ì—¬ íŒŒì‹±í•©ë‹ˆë‹¤.\n  const rawText = $input.first().json.text;\n  // ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡(```json ... ```) ì œê±°\n  const cleanJson = rawText.replace(/```json/g, \"\").replace(/`/g, \"\").trim();\n\n  try {\n    return {\n      json: JSON.parse(cleanJson)\n    };\n  } catch (error) {\n    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ ë°˜í™˜ (ë””ë²„ê¹…ìš©)\n    return {\n      json: {\n        error: \"JSON Parsing Failed\",\n        raw: rawText\n      }\n    };\n  }"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [288, -320],
      "id": "4b391b28-8566-4560-b1df-1fbd42b680ae",
      "name": "Parse Expression JSON"
    },
    {
      "parameters": {
        "jsCode": "  // Geminiì˜ ì‘ë‹µì—ì„œ JSON ë¬¸ìì—´ ë¶€ë¶„ë§Œ ì¶”ì¶œí•˜ì—¬ íŒŒì‹±í•©ë‹ˆë‹¤.\n  const rawText = $input.first().json.text;\n  // ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡(```json ... ```) ì œê±°\n  const cleanJson = rawText.replace(/```json/g, \"\").replace(/`/g, \"\").trim();\n\n  try {\n    return {\n      json: JSON.parse(cleanJson)\n    };\n  } catch (error) {\n    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ ë°˜í™˜ (ë””ë²„ê¹…ìš©)\n    return {\n      json: {\n        error: \"JSON Parsing Failed\",\n        raw: rawText\n      }\n    };\n  }"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [960, -160],
      "id": "6dae234a-7f34-4704-bb66-359150049071",
      "name": "Parse Content JSON"
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Pick Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Expression Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Content Generator",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Pick Category": {
      "main": [
        [
          {
            "node": "Gemini Expression Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Expression Generator": {
      "main": [
        [
          {
            "node": "Parse Expression JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Content Generator": {
      "main": [
        [
          {
            "node": "Parse Content JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Duplicate": {
      "main": [
        [
          {
            "node": "If New",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If New": {
      "main": [
        [
          {
            "node": "Gemini Content Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Expression JSON": {
      "main": [
        [
          {
            "node": "Check Duplicate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Content JSON": {
      "main": [
        [
          {
            "node": "Supabase Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "your-version-id",
  "meta": {
    "instanceId": "your-instance-id"
  },
  "id": "your-workflow-id",
  "tags": []
}
