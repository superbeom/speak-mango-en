# 랜덤 퀴즈 기능 아키텍처 (Random Quiz Architecture)

## 개요

이 문서는 "랜덤 퀴즈" 기능의 아키텍처 및 구현 계획을 기술합니다. 이 기능은 사용자가 무작위로 선정된 10개의 표현에 대한 퀴즈를 풀며 게임처럼 학습 내용을 복습하고 강화할 수 있도록 설계되었습니다.

## 목표

1.  **참여도 증대 (Engagement)**: 퀴즈 형태의 게임화된 요소를 통해 사용자의 학습 흥미와 체류 시간을 높입니다.
2.  **새로운 표현 발견 (Discovery)**: 사용자가 평소 접하지 못했던 무작위 표현들을 자연스럽게 노출시킵니다.
3.  **지속적인 학습 (Continuous Learning)**: 10문제 단위의 무한 루프(문제 풀이 -> 결과 -> 새로운 10문제)를 제공하여 끊임없는 학습을 유도합니다.

## 사용자 플로우 (User Flow)

1.  **진입 (Entry Point)**:
    - 홈 화면 또는 네비게이션 바의 "랜덤 퀴즈(Random Quiz)" 또는 "퀴즈 시작(Start Quiz)" 버튼 클릭.
    - `/quiz` 페이지로 이동.

2.  **퀴즈 세션 초기화 (Loading & Fetching)**:
    - 서버에서 무작위 표현 10개를 DB로부터 가져옵니다.
    - 클라이언트는 데이터를 수신하고 퀴즈 세션을 초기화합니다.

3.  **퀴즈 인터랙션 (Question by Question)**:
    - **화면 표시**: 10개 중 현재 문제 번호 표시 (예: 1/10).
    - **질문 UI**:
      - 질문 텍스트 (패턴 2 형식: "When would you use '...'?").
      - 보기 A, B, C (상황 설명).
    - **사용자 동작**: 사용자가 보기를 클릭하여 정답 선택.
    - **즉각적인 피드백 (Immediate Feedback)**:
      - **정답**: "정답입니다! 🎉" 애니메이션 및 짧은 팁/해설 표시. "다음(Next)" 버튼 활성화.
      - **오답**: "다시 시도해보세요" 또는 오답 표시. 정답 하이라이트.
    - **이동**: "다음" 버튼 클릭 시 다음 문제로 이동.
    - **학습 연결**: 각 문제 하단에 "이 표현 공부하기(Study Context)" 버튼을 제공하여, 퀴즈 도중 해당 표현의 상세 페이지를 새 탭/창으로 열어 학습할 수 있도록 함.

4.  **완료 및 결과 (Completion & Results)**:
    - 10문제를 모두 풀면 "세션 완료" 요약 화면 표시.
    - 최종 점수 표시 (예: "8/10").
    - "틀린 표현 목록"을 제공하여 복습 유도.

5.  **루프 (Loop)**:
    - 주요 버튼(Primary CTA): "새로운 퀴즈 시작하기 (Start New Quiz)" -> 새로운 랜덤 10문제를 로드하여 다시 시작.
    - 보조 버튼(Secondary CTA): "홈으로 가기 (Go Home)".

## 기술 아키텍처

### 1. 데이터베이스 & API

- **Endpoint/Function**: `getRandomExpressions(limit: 10)`
  - **Implementation**: `speak_mango_en.get_random_expressions` RPC 함수 사용.
  - **Mechanism**: PostgreSQL의 `ORDER BY RANDOM()`을 서버 사이드에서 실행하여 전체 데이터 조회 없이 효율적으로 무작위 표본을 추출.
- **퀴즈 파싱**: `content.[lang].quiz.question` 문자열을 구조화된 데이터(질문 텍스트, 보기 배열)로 변환하는 로직 재사용 (유틸리티 함수화).

### 2. 프론트엔드 컴포넌트 (`app/quiz/page.tsx`)

- **Server Component**: 초기 데이터(10개 표현)를 페칭합니다.
- **Client Component (`QuizGame.tsx`)**: 게임 상태를 관리합니다.
  - `questions`: 퀴즈 데이터 배열.
  - `currentIndex`: 현재 문제 인덱스 (0-9).
  - `score`: 정답 개수 추적.
  - `showResult`: 결과 화면 표시 여부.
  - `history`: 결과 요약 화면을 위한 사용자 응답 기록.

### 3. 상태 관리 (State Management)

- 세션 범위 내에서는 React Local State만으로 충분합니다.
- V1 단계에서는 전역 상태(Global Store)나 영구 저장(Persistence)이 필요하지 않습니다.

## 향후 고려사항 (Post-Auth)

- **학습 이력 저장**: 퀴즈 결과를 사용자 프로필/학습 통계에 저장.
- **개인화 알고리즘**: 완전 무작위가 아닌, 사용자가 "틀린 문제"나 "학습하지 않은 표현" 위주로 출제하는 알고리즘 적용.
