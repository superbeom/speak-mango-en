# useSWR ì „ëµ ë° ê°€ì´ë“œë¼ì¸

## 1. useSWRì´ë€?

**useSWR**ì€ Vercel íŒ€(Next.js ê°œë°œíŒ€)ì—ì„œ ê°œë°œí•œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°(Data Fetching)ë¥¼ ìœ„í•œ React Hook ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

- **ì´ë¦„ ìœ ë˜**: HTTP ìºì‹œ ë¬´íš¨í™” ì „ëµì¸ **Stale-While-Revalidate**ì—ì„œ ë”°ì™”ìŠµë‹ˆë‹¤.
- **í•µì‹¬ ê°œë…**: "ìºì‹œëœ ë°ì´í„°(Stale)ë¥¼ ë¨¼ì € ë³´ì—¬ì£¼ê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„°ë¥¼ ì¬ê²€ì¦(Revalidate)í•˜ì—¬ ìµœì‹ í™”í•œë‹¤"ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì™œ ì‚¬ìš©í•˜ëŠ”ê°€? (ì‚¬ìš© ì‚¬ë¡€)

ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” Server Components(`async/await`)ì™€ ë‹¬ë¦¬, useSWRì€ **í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ**ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤:

1.  **ì‹¤ì‹œê°„ ë°ì´í„°**: ì£¼ì‹ ì°¨íŠ¸, ì•Œë¦¼, ì‹¤ì‹œê°„ ëŒ“ê¸€ ë“± (ì£¼ê¸°ì  ê°±ì‹  í•„ìš”).
2.  **ì‚¬ìš©ì ë°˜ì‘í˜• ë°ì´í„°**: ì¢‹ì•„ìš” ìˆ˜, ì¥ë°”êµ¬ë‹ˆ, ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ (ìƒí˜¸ì‘ìš©ì— ë”°ë¼ ë³€í™”).
3.  **ë¹ ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ (Optimistic UI)**: í˜ì´ì§€ ì´ë™ ì‹œ ë¡œë”© ì—†ì´ ì¦‰ì‹œ ì´ì „ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ê³  ì‹¶ì„ ë•Œ.
4.  **ì¤‘ë³µ ì œê±° (Deduplication)**: ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ APIë¥¼ í˜¸ì¶œí•  ë•Œ ì„œë²„ ë¶€í•˜ë¥¼ ì¤„ì´ê¸° ìœ„í•´.

---

## 2. Speak Mango ë„ì… ì‹œ ì´ì 

### A. ë¹ ë¥¸ ë„¤ë¹„ê²Œì´ì…˜ (UX)

- ì‚¬ìš©ìê°€ ìƒì„¸ í˜ì´ì§€ì—ì„œ `í‘œí˜„ ë¦¬ìŠ¤íŠ¸`ë¡œ ëŒì•„ì˜¬ ë•Œ, SWRì€ ìºì‹œëœ ë¦¬ìŠ¤íŠ¸ë¥¼ **ì¦‰ì‹œ** ë³´ì—¬ì¤ë‹ˆë‹¤.
- ì´ë¡œ ì¸í•´ "ë¡œë”© ìŠ¤í”¼ë„ˆ ê¹œë¹¡ì„"ì´ ì‚¬ë¼ì§€ê³  ì•±ì´ ì¾Œì í•˜ê²Œ ëŠê»´ì§‘ë‹ˆë‹¤.

### B. ìë™ ê°±ì‹  (Automatic Revalidation)

- **Focus Revalidation**: ë¸Œë¼ìš°ì € íƒ­ì„ ë‚˜ê°”ë‹¤ê°€ ë‹¤ì‹œ í´ë¦­í–ˆì„ ë•Œ ë°ì´í„°ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
- **Reconnect Revalidation**: ë„¤íŠ¸ì›Œí¬ê°€ ëŠê²¼ë‹¤ê°€ ë‹¤ì‹œ ì—°ê²°ëì„ ë•Œ ë°ì´í„°ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.

### C. ì¤‘ë³µ ìš”ì²­ ì œê±° (Deduplication)

- ë§Œì•½ `Header`ì˜ ìœ ì € ì •ë³´ì™€ `Sidebar`ì˜ ìœ ì € ì •ë³´ ë“± ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì¼í•œ ë°ì´í„°ë¥¼ í•„ìš”ë¡œ í•œë‹¤ë©´, ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë„êµ¬ ì—†ì´ë„ `useSWR('/api/user')`ë¥¼ í˜¸ì¶œí•˜ë©´ **ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì€ ë”± 1ë²ˆë§Œ** ë°œìƒí•©ë‹ˆë‹¤.

### D. ì½”ë“œ ê°„ì†Œí™”

- ë³µì¡í•œ `useEffect`, `useState`, `isLoading` ë¡œì§ì„ ë‹¨ í•œ ì¤„ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 3. ê¸°ë³¸ ì‚¬ìš©ë²•

```tsx
import useSWR from "swr";

// 1. Fetcher í•¨ìˆ˜ ì •ì˜ (fetch ë˜ëŠ” axios ì‚¬ìš©)
const fetcher = (url: string) => fetch(url).then((res) => res.json());

function Profile() {
  // 2. ì‚¬ìš©: useSWR(í‚¤, fetcher)
  const { data, error, isLoading } = useSWR("/api/user", fetcher);

  if (error) return <div>Failed to load</div>;
  if (isLoading) return <div>Loading...</div>;

  // 3. ë Œë”ë§
  return <div>Hello, {data.name}!</div>;
}
```

---

## 4. Speak Mango ì ìš© ê³„íš

í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ë¥¼ ë¶„ì„í•˜ì—¬ `useSWR`ì´ ê°€ì¥ íš¨ê³¼ì ì¸ ë¶€ë¶„ì„ ì„ ë³„í–ˆìŠµë‹ˆë‹¤.

### âœ… [Implemented] ë¬´í•œ ìŠ¤í¬ë¡¤ (`usePaginatedList`)

í˜„ì¬ `hooks/usePaginatedList.ts`ëŠ” í˜ì´ì§€ ìƒíƒœ(`items`, `page`)ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , ë’¤ë¡œê°€ê¸° ë³µì›ì„ ìœ„í•´ `ExpressionContext`ë¼ëŠ” ë³„ë„ì˜ ì»¤ìŠ¤í…€ Contextë¥¼ ì‚¬ìš©í•˜ì—¬ ìºì‹±í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**ì œì•ˆ: `useSWRInfinite` ë„ì…**

`useSWRInfinite`ë¡œ ì „í™˜í•˜ë©´ ì´ ë¡œì§ì„ ëŒ€í­ ë‹¨ìˆœí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1.  **ìˆ˜ë™ ìºì‹± ì œê±°**: SWR ë‚´ì¥ ì „ì—­ ìºì‹œê°€ ë°ì´í„° ë³´ì¡´ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
2.  **ë³µì¡í•œ ìƒíƒœ ì œê±°**: `items` ë°°ì—´ í•©ì¹˜ê¸° ë“±ì˜ ë¡œì§ì„ SWRì´ ëŒ€ì‹ í•©ë‹ˆë‹¤.
3.  **ìë™ ë™ê¸°í™”**: ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ê³³ì—ì„œ í‘œí˜„ì„ ìˆ˜ì •í•˜ë©´, í‚¤ ë§¤ì¹­ì„ í†µí•´ ë¦¬ìŠ¤íŠ¸ë„ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**êµ¬í˜„ ì˜ˆì‹œ:**

```tsx
import useSWRInfinite from "swr/infinite";

const getKey = (pageIndex, previousPageData) => {
  if (previousPageData && !previousPageData.length) return null; // ë°ì´í„° ë ë„ë‹¬
  return `/api/expressions?page=${pageIndex + 1}&limit=12`; // API ì—”ë“œí¬ì¸íŠ¸ í‚¤
};

export function useExpressionInfinite() {
  const { data, size, setSize, isLoading } = useSWRInfinite(getKey, fetcher);

  // ë°ì´í„° í‰íƒ„í™” (2ì°¨ì› ë°°ì—´ -> 1ì°¨ì› ë°°ì—´)
  const expressions = data ? data.flat() : [];
  const isLoadingMore =
    isLoading || (size > 0 && data && typeof data[size - 1] === "undefined");
  const isEmpty = data?.[0]?.length === 0;
  const isReachingEnd = isEmpty || (data && data[data.length - 1]?.length < 12);

  return { expressions, loadMore: () => setSize(size + 1), isReachingEnd };
}
```

> **êµ¬í˜„ ì™„ë£Œ (2026-01-21)**: `hooks/usePaginatedList.ts` ë¦¬íŒ©í† ë§ ë° `ExpressionContext` ìµœì í™”(items ì œê±°)ë¥¼ í†µí•´ ì ìš© ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
>
> - **Serialization**: í•„í„° í‚¤ ì§ë ¬í™”(`JSON.stringify`)ë¥¼ í†µí•´ ê°ì²´ ì°¸ì¡° ë³€ê²½ì— ë”°ë¥¸ ë¶ˆí•„ìš”í•œ ìš”ì²­ì„ ë°©ì§€í–ˆìŠµë‹ˆë‹¤. Fetcher í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `JSON.parse`ì™€ `as ExpressionFilters` ìºìŠ¤íŒ…ì„ ì‚¬ìš©í•˜ì—¬ íƒ€ì… ì•ˆì •ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.
> - **Revalidation**: ì½˜í…ì¸  ì—…ë°ì´íŠ¸ ë¹ˆë„(Daily)ë¥¼ ê³ ë ¤í•˜ì—¬ `revalidateFirstPage: false`ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ì´ˆê¸° ì§„ì… ì‹œ ë¶ˆí•„ìš”í•œ ë°±ê·¸ë¼ìš´ë“œ ìš”ì²­ì„ ë°©ì§€í•˜ì—¬ íŠ¸ë˜í”½ ë¹„ìš©ì„ ì ˆê°í•©ë‹ˆë‹¤. (í•„í„° ë³€ê²½ ì‹œì—ëŠ” í‚¤ê°€ ë°”ë€Œë¯€ë¡œ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.)

### ğŸ”œ ì¶”í›„ ì ìš© í›„ë³´

1.  **í€´ì¦ˆ ë­í‚¹ / í†µê³„**:
    - "ì‹¤ì‹œê°„ ë¦¬ë”ë³´ë“œ"ë‚˜ "ì „ì²´ ì‚¬ìš©ì í†µê³„" ê¸°ëŠ¥ ì¶”ê°€ ì‹œ `refreshInterval` ì˜µì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì™„ë²½í•©ë‹ˆë‹¤.
2.  **ì‚¬ìš©ì í•™ìŠµ ì§„ë„**:
    - í€´ì¦ˆ ê²°ê³¼ ì œì¶œ í›„, í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´ "ë‚˜ì˜ í•™ìŠµ í˜„í™©" ëŒ€ì‹œë³´ë“œë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸í•˜ê³  ì‹¶ì„ ë•Œ `mutate`(ë‚™ê´€ì  ì—…ë°ì´íŠ¸)ë¥¼ ì‚¬ìš©í•˜ë©´ ë§¤ìš° ë¹ ë¦¿í•œ ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 5. ì „ì—­ ë®¤í…Œì´íŠ¸ ë° ìºì‹œ ë¬´íš¨í™” (Global Mutate & Cache Invalidation)

ë‹¨ì¼ ë¦¬ìŠ¤íŠ¸ì˜ ë°ì´í„° ë³€ê²½ì´ ë‹¤ë¥¸ ë¦¬ìŠ¤íŠ¸ì˜ ìƒíƒœì— ì˜í–¥ì„ ì¤„ ë•Œ, `useSWRConfig`ì—ì„œ ì œê³µí•˜ëŠ” `globalMutate`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë ¨ ìºì‹œë¥¼ ì¼ê´„ì ìœ¼ë¡œ ë¬´íš¨í™”í•©ë‹ˆë‹¤.

### ì‚¬ìš© ì‚¬ë¡€: ê¸°ë³¸ ë‹¨ì–´ì¥(Default List) ë³€ê²½

- **ë¬¸ì œ**: ì‚¬ìš©ìê°€ 'A' ë‹¨ì–´ì¥ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•˜ë©´, ê¸°ì¡´ì— ê¸°ë³¸ì´ì—ˆë˜ 'B' ë‹¨ì–´ì¥ì€ ë” ì´ìƒ ê¸°ë³¸ì´ ì•„ë‹ˆê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ 'B' ë‹¨ì–´ì¥ ìƒì„¸ í˜ì´ì§€ì˜ SWR ìºì‹œëŠ” ì—¬ì „íˆ `is_default: true`ì¸ ìƒíƒœë¡œ ë‚¨ì•„ ìˆì–´ UI ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
- **í•´ê²°**: `globalMutate`ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • íŒ¨í„´ì„ ê°€ì§„ ëª¨ë“  ìºì‹œ í‚¤ë¥¼ ì°¾ì•„ ë¬´íš¨í™”í•©ë‹ˆë‹¤.

```tsx
const { mutate: globalMutate } = useSWRConfig();

globalMutate(
  (key) =>
    Array.isArray(key) && // SWR í‚¤ê°€ ë°°ì—´ í˜•íƒœì¸ì§€ í™•ì¸
    key[0] === "vocabulary-details" && // ë‹¨ì–´ì¥ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í‚¤
    key[1] !== listId, // í˜„ì¬ í™œì„±í™”ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€
  undefined, // ê°±ì‹ í•  ë°ì´í„°ë¥¼ ì§ì ‘ ì£¼ì§€ ì•Šê³  (ì„œë²„ì—ì„œ ìƒˆë¡œ ê°€ì ¸ì˜¬ ê²ƒì´ë¯€ë¡œ)
  { revalidate: true }, // "ìºì‹œê°€ ìƒí–ˆìœ¼ë‹ˆ ì„œë²„ì—ì„œ ë‹¤ì‹œ ë°›ì•„ì™€ë¼"ê³  ëª…ë ¹
);
```
